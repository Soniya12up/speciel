<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Nayanika ‚ù§Ô∏è</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Montserrat:wght@200;300;400&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- CORE STYLES --- */
        body {
            margin: 0; overflow: hidden; background-color: #050203; 
            font-family: 'Montserrat', sans-serif; color: #e5e5e5;
            cursor: none; user-select: none;
        }

        /* Custom Cursor */
        #cursor-dot {
            width: 8px; height: 8px; background: #f472b6; border-radius: 50%;
            position: fixed; pointer-events: none; z-index: 9999;
            box-shadow: 0 0 10px #f472b6; transition: transform 0.1s;
        }
        .sparkle {
            position: fixed; pointer-events: none; z-index: 9998;
            background: white; border-radius: 50%; animation: fadeAndScale 1s linear forwards;
        }
        @keyframes fadeAndScale { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

        /* Background Effects */
        .film-grain {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("https://upload.wikimedia.org/wikipedia/commons/7/76/Noise.png");
            opacity: 0.06; pointer-events: none; z-index: 5;
            animation: grain 8s steps(10) infinite;
        }
        @keyframes grain { 0%, 100% { transform: translate(0, 0); } 10% { transform: translate(-5%, -10%); } 90% { transform: translate(-1%, 7%); } }

        /* Typography & Animations */
        h1, h2, h3 { font-family: 'Cormorant Garamond', serif; font-weight: 600; }
        .handwritten { font-family: 'Dancing Script', cursive; }
        .breathe-text { animation: breathe 4s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { opacity: 0.9; transform: scale(1); } 50% { opacity: 1; transform: scale(1.02); text-shadow: 0 0 15px rgba(255,255,255,0.2); } }
        .heartbeat-glow { animation: heartbeat 2s infinite; display: inline-block; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); text-shadow: 0 0 10px rgba(244,114,182,0.5); } 50% { transform: scale(1.05); text-shadow: 0 0 25px rgba(244,114,182,0.9); } }

        /* Glass Panel */
        .glass-panel {
            background: rgba(15, 10, 12, 0.5); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 0 50px rgba(0,0,0,0.9);
            width: 100%; height: 100vh; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .chapter-container {
            position: absolute; inset: 0; padding: 1.5rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; text-align: center; z-index: 10;
        }
        .chapter-active { opacity: 1; visibility: visible; z-index: 20; }

        /* --- GALLERY STYLES --- */
        #gallery-stage {
            position: relative; width: 100%; height: 50vh;
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 20px; perspective: 1000px;
        }
        .polaroid {
            position: absolute; background: white; padding: 10px 10px 30px 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); transition: all 1s ease;
            width: 250px; transform-origin: center;
        }
        .polaroid img { width: 100%; aspect-ratio: 4/5; object-fit: cover; }
        .polaroid.active { z-index: 50; transform: scale(1.1) rotate(0deg) !important; filter: drop-shadow(0 0 20px rgba(236, 72, 153, 0.6)); }
        .polaroid.bg { z-index: 1; opacity: 0.3; filter: blur(2px) grayscale(50%); }
        #gallery-caption {
            min-height: 60px; max-width: 600px; font-size: 1.2rem; color: #fbcfe8;
            font-family: 'Dancing Script', cursive; text-shadow: 0 0 10px rgba(236, 72, 153, 0.5);
        }

        /* --- CAKE STYLES (FIXED) --- */
        .cake-body { 
            width: 180px; height: 100px; background: #fce7f3; 
            border-radius: 10px 10px 0 0; position: relative; 
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .icing { position: absolute; top: 0; left: 0; width: 100%; height: 35px; background: #f472b6; border-radius: 10px 10px 20px 20px; }
        .candles-container { display: flex; gap: 20px; margin-bottom: -5px; z-index: 10; align-items: flex-end; }
        
        .candle { 
            width: 12px; height: 45px; background: #fff; position: relative; cursor: pointer; border-radius: 2px;
            box-shadow: inset -2px 0 rgba(0,0,0,0.1);
        }
        /* Hit area for easier clicking on mobile */
        .candle::after { content: ''; position: absolute; inset: -10px; z-index: 20; } 

        .flame { 
            width: 14px; height: 24px; background: #fbbf24; 
            border-radius: 50% 50% 20% 20%; position: absolute; 
            top: -24px; left: -1px; 
            animation: flicker 0.6s infinite alternate; 
            box-shadow: 0 0 15px #f59e0b;
            transform-origin: center bottom;
        }
        
        /* The Class that hides the flame */
        .flame.out { 
            animation: none; /* Stop flickering */
            opacity: 0; 
            transform: scale(0); 
            transition: all 0.3s ease-out; 
        }

        @keyframes flicker { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.1); opacity: 0.8; } }

        /* --- OTHER UI --- */
        .soul-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.3); color: rgba(255,255,255,0.9);
            padding: 12px 30px; font-family: 'Montserrat', sans-serif; font-size: 0.75rem; letter-spacing: 2px;
            text-transform: uppercase; transition: all 0.5s ease; position: relative; overflow: hidden; cursor: pointer;
            margin-top: 20px; z-index: 50;
        }
        .soul-btn:hover { border-color: #f472b6; color: #fff; box-shadow: 0 0 20px rgba(244, 114, 182, 0.3); background: rgba(244, 114, 182, 0.1); }
        .envelope-container { cursor: pointer; transition: transform 0.3s; } .envelope-container:hover { transform: scale(1.05); }
        .wax-seal { width: 60px; height: 60px; background: #9f1239; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 2px solid #be123c; color: white; font-size: 24px; }
        .letter-paper { background: #fff1f2; color: #4a044e; width: 90%; max-width: 500px; max-height: 60vh; padding: 2rem; border-radius: 2px; transform: scale(0.8); overflow-y: auto; text-align: left; }
        
        #loader { background: #000; position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; }
        .memory-photo { box-shadow: 0 0 40px rgba(244, 114, 182, 0.3); border: 1px solid rgba(255,255,255,0.2); animation: float 8s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(1deg); } }
        .text-content-scroll { max-height: 50vh; overflow-y: auto; padding: 0 10px; width: 100%; }

    </style>
</head>
<body>

    <!-- Cursor & Effects -->
    <div id="cursor-dot"></div>
    <div class="film-grain"></div>

    <!-- Audio -->
    <audio id="bg-music" loop preload="auto">
        <source src="songs1/love12.mp3" type="audio/mpeg">
    </audio>

    <!-- Background -->
    <canvas id="bg-canvas" style="position: fixed; top:0; left:0; z-index:-2;"></canvas>

    <!-- Loader -->
    <div id="loader">
        <p class="text-white font-light tracking-[0.5em] text-xs uppercase animate-pulse">Gathering Memories...</p>
    </div>

    <!-- Intro -->
    <div id="intro-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-1000 hidden">
        <p class="text-pink-300 handwritten text-3xl mb-4 opacity-80 breathe-text">For my soulmate,</p>
        <h1 class="text-5xl md:text-7xl text-white mb-8 tracking-wide heartbeat-glow">Nayanika</h1>
        <p class="text-gray-500 text-xs uppercase tracking-widest mb-12">Please wear headphones</p>
        <button onclick="startJourney()" class="soul-btn">Open My Heart</button>
    </div>

    <!-- Main Stage -->
    <div id="main-stage" class="glass-panel opacity-0 transition-opacity duration-1000 hidden">

        <!-- Progress Bar -->
        <div class="absolute top-6 left-1/2 transform -translate-x-1/2 w-32 h-0.5 bg-white/10 rounded-full overflow-hidden z-30">
            <div id="progress" class="h-full bg-pink-500 w-0 transition-all duration-1000"></div>
        </div>

        <!-- CHAP 1: Intro -->
        <div id="chap-1" class="chapter-container chapter-active">
            <div class="w-40 h-40 md:w-52 md:h-52 mb-6 rounded-full p-1 border border-pink-500/30 bg-pink-500/10 memory-photo">
                <img src="New folder (3)/mylove1.jpg" class="w-full h-full object-cover rounded-full">
            </div>
            <h2 class="text-3xl md:text-5xl text-pink-100 mb-6 italic breathe-text">The Day The World Changed</h2>
            <div class="emotional-text text-center space-y-4 max-w-lg text-sm md:text-base">
                <p>Before you, I didn't realize how loud the world was. Then you walked in, and suddenly...</p>
                <p class="text-pink-300 italic">Everything became a melody.</p>
            </div>
            <button onclick="nextChapter()" class="soul-btn">Enter My World</button>
        </div>

        <!-- CHAP 2: Interactive Gallery -->
        <div id="chap-2" class="chapter-container">
            <h2 class="text-3xl text-pink-200 mb-2 font-serif">The Museum of You</h2>
            <div id="gallery-stage">
                <!-- Photos inserted by JS -->
            </div>
            <p id="gallery-caption" class="breathe-text px-4 text-center"></p>
            <button id="gallery-btn" onclick="revealNextMemory()" class="soul-btn mt-2">See My World</button>
        </div>

        <!-- CHAP 3: Why It's You -->
        <div id="chap-3" class="chapter-container">
            <h2 class="text-3xl text-pink-100 mb-6 heartbeat-glow">Why It's You</h2>
            <div class="grid grid-cols-1 gap-4 w-full max-w-lg text-center">
                <div class="bg-white/5 p-5 border border-white/10 rounded-lg">
                    <h3 class="text-xl text-pink-300 mb-1 handwritten">Your Kindness</h3>
                    <p class="text-sm text-gray-300 font-light">The way you treat the world makes me want to be a better man.</p>
                </div>
                <div class="bg-white/5 p-5 border border-white/10 rounded-lg">
                    <h3 class="text-xl text-pink-300 mb-1 handwritten">Your Laugh</h3>
                    <p class="text-sm text-gray-300 font-light">It is my favorite sound. I would spend my life trying to make you smile.</p>
                </div>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-6">A Letter For You</button>
        </div>

        <!-- CHAP 4: Love Letter -->
        <div id="chap-4" class="chapter-container">
            <div id="letter-closed" class="flex flex-col items-center justify-center envelope-container" onclick="openLetter()">
                <div class="relative">
                    <div class="w-64 h-40 bg-pink-900/40 border border-pink-500/30 rounded-lg flex items-center justify-center backdrop-blur-md shadow-2xl">
                        <div class="wax-seal"><span class="heartbeat-glow">‚ù§</span></div>
                    </div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-pink-200 handwritten text-2xl">For Nayanika</div>
                </div>
                <p class="text-xs text-gray-400 mt-8 uppercase tracking-widest animate-pulse">Tap to Open</p>
            </div>

            <div id="letter-content" class="letter-paper hidden custom-scroll">
                <p class="text-lg font-serif italic leading-relaxed">
                    My Dearest Nayanika, <br><br>
                    I wanted to write this because sometimes saying it out loud isn't enough. <br><br>
                    Since the moment you entered my life, colors seem brighter. You are the thought that wakes me up and the dream that puts me to sleep. <br><br>
                    Thank you for being my peace in chaos, my strength in weakness, and my best friend in everything. I don't know what the future holds, but as long as your hand is in mine, I know it will be beautiful.<br><br>
                    I love you more than words can carry.<br><br>
                    Forever yours,<br>
                    (Your Name)
                </p>
                <div class="w-full flex justify-center mt-6">
                    <button onclick="nextChapter()" class="text-pink-800 border border-pink-800 px-6 py-2 rounded-full uppercase text-xs tracking-widest hover:bg-pink-800 hover:text-white transition">My Promise</button>
                </div>
            </div>
        </div>

        <!-- CHAP 5: Promise -->
        <div id="chap-5" class="chapter-container">
            <div class="max-w-xl text-center px-4">
                <p class="text-xs tracking-widest text-gray-500 uppercase mb-4">A vow to Nayanika</p>
                <h1 class="text-3xl md:text-5xl text-white mb-6 leading-tight breathe-text">"In Every Lifetime."</h1>
                <p class="text-gray-300 mb-6">If we are born again, I will find you sooner. I will love you longer.</p>
                <p class="text-pink-200 italic font-serif">"You are not just my love. You are my soul's home."</p>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-4">Make a Wish</button>
        </div>

        <!-- CHAP 6: Cake (FIXED) -->
        <div id="chap-6" class="chapter-container">
            <h2 class="text-3xl text-white mb-2 handwritten">Happy Birthday, Sunu</h2>
            <p id="cake-instruction" class="text-xs tracking-widest text-pink-400 uppercase mb-8 animate-pulse">Tap the candles to make a wish</p>
            
            <div id="cake-section" class="flex flex-col items-center relative">
                <div class="candles-container">
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                </div>
                <div class="cake-body" onclick="cutCake()">
                    <div class="icing"></div>
                    <span class="text-pink-900/20 text-4xl font-bold select-none z-10">üéÇ</span>
                </div>
                <div class="w-48 h-2 bg-white/10 rounded-full mt-2 blur-sm"></div>
            </div>
        </div>

        <!-- CHAP 7: Finale -->
        <div id="chap-7" class="chapter-container">
            <div class="relative group cursor-pointer perspective-1000 mb-6">
                <div class="absolute -inset-4 bg-pink-600/30 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition duration-1000"></div>
                <img src="New folder (3)/surprise.jpg" id="final-img" class="relative w-64 md:w-80 rounded-lg border-2 border-white/20 shadow-2xl transform scale-95 opacity-0">
            </div>
            <div class="h-24 w-full flex items-center justify-center px-4">
                <h1 id="typewriter" class="text-xl md:text-3xl text-pink-200 font-serif italic text-center leading-relaxed heartbeat-glow"></h1>
            </div>
            <p class="text-gray-600 text-xs mt-8">I love you. Forever.</p>
        </div>

    </div>

    <!-- Music Control -->
    <div onclick="toggleMusic()" class="fixed bottom-6 right-6 text-white/50 hover:text-white cursor-pointer z-50 transition duration-300 p-2 bg-black/20 rounded-full backdrop-blur-sm border border-white/10">
        <span id="music-status">üîá Play Music</span>
    </div>

    <script>
        // --- MOUSE SPARKLE ---
        const cursorDot = document.getElementById("cursor-dot");
        document.addEventListener("mousemove", (e) => {
            cursorDot.style.left = e.clientX + "px"; cursorDot.style.top = e.clientY + "px";
            createSparkle(e.clientX, e.clientY);
        });
        function createSparkle(x, y) {
            const s = document.createElement("div"); s.classList.add("sparkle"); document.body.appendChild(s);
            const size = Math.random() * 4 + 2; s.style.width = `${size}px`; s.style.height = `${size}px`;
            s.style.left = `${x}px`; s.style.top = `${y}px`;
            setTimeout(() => { s.remove(); }, 1000);
        }

        // --- GALLERY LOGIC ---
        const memories = [
            { src: "New folder (3)/mylove1.jpg", text: "Your smile is the sun that breaks my winter.", btn: "See My Soul" },
            { src: "New folder (3)/mylove2.jpg", text: "Eyes that hold the entire universe within them.", btn: "See My Heart" },
            { src: "New folder (3)/mylove3.jpg", text: "This moment? I want to live in it forever.", btn: "See My Breath" },
            { src: "New folder (3)/mylove4.jpg", text: "Elegance isn't what you wear, it's who you are.", btn: "See My Peace" },
            { src: "New folder (3)/mylove5.jpg", text: "Even in chaos, you are my calm.", btn: "See My Joy" },
            { src: "New folder (3)/mylove6.jpg", text: "Your laugh heals parts of me I didn't know were broken.", btn: "See My Life" },
            { src: "New folder (3)/mylove7.jpg", text: "My favorite view in the whole world.", btn: "See My Forever" },
            { src: "New folder (3)/mylove8.jpg", text: "Us. My favorite story.", btn: "Go Deeper" }
        ];

        let memoryIndex = 0;

        function revealNextMemory() {
            if (memoryIndex >= memories.length) { nextChapter(); return; }
            const stage = document.getElementById("gallery-stage");
            const data = memories[memoryIndex];

            // Move old photos
            stage.querySelectorAll(".polaroid.active").forEach(p => {
                p.classList.remove("active"); p.classList.add("bg");
                const rot = (Math.random() - 0.5) * 40;
                const x = (Math.random() - 0.5) * 300;
                const y = (Math.random() - 0.5) * 100;
                gsap.to(p, { x: x, y: y, rotation: rot, scale: 0.8, duration: 1 });
            });

            // New photo
            const div = document.createElement("div"); div.className = "polaroid active";
            gsap.set(div, { y: 100, opacity: 0, scale: 0.5 });
            const img = document.createElement("img"); img.src = data.src;
            div.appendChild(img); stage.appendChild(div);
            gsap.to(div, { y: 0, opacity: 1, scale: 1.2, duration: 1, ease: "back.out(1.2)" });

            // Text
            const caption = document.getElementById("gallery-caption");
            const btn = document.getElementById("gallery-btn");
            gsap.to(caption, { opacity: 0, duration: 0.2, onComplete: () => {
                caption.innerText = `"${data.text}"`;
                gsap.to(caption, { opacity: 1, duration: 0.5 });
            }});
            btn.innerText = data.btn;
            memoryIndex++;
        }

        // --- CORE NAV ---
        window.onload = () => {
            gsap.to("#loader", { opacity: 0, duration: 1.5, onComplete: () => {
                document.getElementById("loader").style.display = "none";
                document.getElementById("intro-screen").classList.remove("hidden");
                initParticles();
            }});
        };

        const audio = document.getElementById('bg-music');
        let musicPlaying = false;
        function toggleMusic() {
            const status = document.getElementById("music-status");
            if(musicPlaying) { audio.pause(); status.innerText = "üîá Play Music"; } 
            else { audio.play().then(() => { status.innerText = "üîä Pause"; }).catch(e => { alert("Interact to play"); }); }
            musicPlaying = !musicPlaying;
        }

        let currentChap = 1;
        const totalChap = 7;

        function startJourney() {
            gsap.to("#intro-screen", { opacity: 0, duration: 2, onComplete: () => {
                document.getElementById("intro-screen").style.display = "none";
                document.getElementById("main-stage").classList.remove("hidden");
                gsap.to("#main-stage", { opacity: 1, duration: 2 });
                audio.volume = 0.5; audio.play().catch(()=>{});
                musicPlaying = true; document.getElementById("music-status").innerText = "üîä Pause";
                animateElements(1);
            }});
        }

        function nextChapter() {
            const curr = document.getElementById(`chap-${currentChap}`);
            const next = document.getElementById(`chap-${currentChap+1}`);
            
            gsap.to("#progress", { width: `${(currentChap/totalChap)*100}%`, duration: 1 });
            gsap.to(curr, { opacity: 0, y: -20, duration: 0.8, ease: "power2.in", onComplete: () => {
                curr.classList.remove("chapter-active");
                if(next) {
                    next.classList.add("chapter-active");
                    gsap.fromTo(next, { opacity: 0, y: 30 }, { opacity: 1, y: 0, duration: 1, ease: "power2.out" });
                    currentChap++;
                    animateElements(currentChap);
                    if(currentChap === 2 && memoryIndex === 0) revealNextMemory();
                }
            }});
        }

        function animateElements(id) {
            gsap.fromTo(`#chap-${id} p, #chap-${id} h2, #chap-${id} h1`, { opacity: 0, y: 15 }, { opacity: 1, y: 0, duration: 1.5, stagger: 0.2, ease: "power3.out" });
            gsap.fromTo(`#chap-${id} .soul-btn`, { opacity: 0, scale: 0.9 }, { opacity: 1, scale: 1, duration: 1, delay: 1.5 });
        }

        function openLetter() {
            gsap.to("#letter-closed", { scale: 0, opacity: 0, duration: 0.5, onComplete: () => {
                document.getElementById("letter-closed").style.display = "none";
                const content = document.getElementById("letter-content");
                content.classList.remove("hidden");
                gsap.fromTo(content, { scale: 0.5, opacity: 0, rotationX: 90 }, { scale: 1, opacity: 1, rotationX: 0, duration: 1, ease: "back.out(1.2)" });
            }});
        }

        // --- CAKE & FLAME FIX ---
        let candlesOut = 0;
        function blowCandle(el) {
            const flame = el.querySelector('.flame');
            // Check if already out to prevent double counting
            if(flame && !flame.classList.contains('out')) {
                flame.classList.add('out'); 
                candlesOut++;
                
                // Add a cute text effect for feedback
                const puff = document.createElement("div");
                puff.innerText = "üí®";
                puff.style.position = "absolute";
                puff.style.top = "-40px";
                puff.style.left = "0";
                puff.style.color = "white";
                puff.style.animation = "fadeAndScale 1s forwards";
                el.appendChild(puff);

                if(candlesOut === 3) {
                    const instr = document.getElementById("cake-instruction");
                    instr.innerText = "Now... tap the cake to cut it."; 
                    instr.classList.add("text-white");
                    gsap.to(".cake-body", { scale: 1.05, yoyo: true, repeat: -1, duration: 0.5 });
                }
            }
        }
        function cutCake() {
            if(candlesOut < 3) return;
            gsap.killTweensOf(".cake-body");
            gsap.to("#chap-6", { opacity: 0, scale: 0.9, duration: 1, onComplete: () => {
                document.getElementById("chap-6").classList.remove("chapter-active");
                document.getElementById("chap-7").classList.add("chapter-active");
                revealFinale();
            }});
        }

        function revealFinale() {
            const end = Date.now() + 5000;
            const colors = ['#fbcfe8', '#f472b6', '#db2777'];
            (function frame() {
                confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: colors, shapes: ['circle'], scalar: 1.2, drift: 0.5 });
                confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: colors, shapes: ['circle'], scalar: 1.2, drift: -0.5 });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());

            gsap.fromTo("#final-img", { scale: 0.8, opacity: 0 }, { scale: 1, opacity: 1, duration: 2, ease: "power3.out" });
            gsap.to("#typewriter", { text: "Happy Birthday, Nayanika. You are my answered prayer. ‚ù§Ô∏è", duration: 5, delay: 1, ease: "none" });
            if(musicPlaying) gsap.to(audio, { volume: 0.8, duration: 4 });
        }

        function initParticles() {
            const canvas = document.getElementById('bg-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            const geometry = new THREE.BufferGeometry();
            const count = 400; const pos = new Float32Array(count*3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*15;
            geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const material = new THREE.PointsMaterial({ size: 0.02, color: 0xffafcc, transparent: true, opacity: 0.5 });
            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                particles.rotation.y += 0.0003; particles.position.y += Math.sin(Date.now()*0.001)*0.001;
                renderer.render(scene, camera);
            }
            animate();
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
</body>
</html>
