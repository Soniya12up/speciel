<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Nayanika ‚ù§Ô∏è</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400;1,600&family=Montserrat:wght@100;200;300;400&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- CINEMATIC CORE --- */
        body {
            margin: 0; overflow: hidden; background-color: #0a0507; 
            font-family: 'Montserrat', sans-serif; color: #fce7f3;
            cursor: none; user-select: none;
        }

        /* Film Grain Overlay */
        .film-grain {
            position: fixed; inset: 0; pointer-events: none; z-index: 5;
            opacity: 0.05; background-image: url("https://upload.wikimedia.org/wikipedia/commons/7/76/Noise.png");
            animation: grain 8s steps(10) infinite;
        }
        @keyframes grain { 0%, 100% { transform: translate(0, 0); } 10% { transform: translate(-5%, -10%); } 90% { transform: translate(-1%, 7%); } }

        /* Ambient Light */
        .ambient-glow {
            position: fixed; top: 50%; left: 50%; width: 120vw; height: 120vh;
            background: radial-gradient(circle, rgba(190, 24, 93, 0.1) 0%, rgba(0,0,0,0) 70%);
            transform: translate(-50%, -50%); z-index: -1; pointer-events: none;
        }

        /* Custom Cursor */
        #cursor-dot {
            width: 8px; height: 8px; background: #f9a8d4; border-radius: 50%;
            position: fixed; pointer-events: none; z-index: 9999;
            box-shadow: 0 0 20px #f472b6; transition: transform 0.1s;
        }
        .sparkle {
            position: fixed; pointer-events: none; z-index: 9998;
            background: white; border-radius: 50%; animation: fadeAndScale 1s linear forwards;
        }
        @keyframes fadeAndScale { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

        /* Typography */
        h1, h2, h3 { font-family: 'Cormorant Garamond', serif; letter-spacing: -0.02em; }
        .handwritten { font-family: 'Dancing Script', cursive; }
        .lux-text { font-family: 'Playfair Display', serif; }
        .breathe-text { animation: breathe 5s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { opacity: 0.8; transform: scale(1); } 50% { opacity: 1; transform: scale(1.02); text-shadow: 0 0 20px rgba(255,192,203,0.3); } }
        
        /* Glass Panel */
        .glass-panel {
            background: rgba(10, 5, 7, 0.3); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
            width: 100%; height: 100vh; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .chapter-container {
            position: absolute; inset: 0; padding: 1.5rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; text-align: center; z-index: 10;
        }
        .chapter-active { opacity: 1; visibility: visible; z-index: 20; }

        /* --- COMPONENTS --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px); box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border-radius: 16px; transition: transform 0.3s;
        }

        .soul-btn {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.9); padding: 14px 32px; 
            font-family: 'Montserrat', sans-serif; font-size: 0.7rem; letter-spacing: 3px;
            text-transform: uppercase; transition: all 0.5s ease;
            margin-top: 30px; cursor: pointer; border-radius: 50px;
            position: relative; overflow: hidden; pointer-events: auto; z-index: 50;
        }
        .soul-btn:hover { background: rgba(255,255,255,0.1); border-color: #fbcfe8; color: #fff; box-shadow: 0 0 30px rgba(244, 114, 182, 0.2); transform: translateY(-2px); }

        /* Funny Grid */
        .funny-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; width: 100%; max-width: 500px; }
        .funny-item { 
            position: relative; aspect-ratio: 1; overflow: hidden; border-radius: 8px; 
            transform: rotate(var(--rot)); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .funny-item:hover { transform: rotate(0deg) scale(1.1); z-index: 50; }
        .funny-item img { width: 100%; height: 100%; object-fit: cover; }

        /* Floating Words */
        #floating-words-container { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
        .floating-word { position: absolute; color: rgba(255, 255, 255, 0.06); font-family: 'Dancing Script', cursive; font-weight: 700; pointer-events: none; animation: floatUp linear forwards; }
        @keyframes floatUp { 0% { transform: translateY(110vh) rotate(0deg); opacity: 0; } 20% { opacity: 0.6; } 100% { transform: translateY(-10vh) rotate(10deg); opacity: 0; } }

        /* Scroll */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #9d174d; border-radius: 10px; }
        
        .letter-paper { 
            background: #fff1f2; color: #831843; width: 90%; max-width: 500px; max-height: 60vh; 
            padding: 2.5rem; border-radius: 2px; overflow-y: auto; text-align: left; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8); position: relative; z-index: 60; 
            display: none; flex-direction: column; pointer-events: auto; 
            font-family: 'Cormorant Garamond', serif; 
        }

        /* Cake & Flame */
        .cake-body { width: 180px; height: 100px; background: #fce7f3; border-radius: 10px 10px 0 0; position: relative; display: flex; align-items: center; justify-content: center; cursor: pointer; pointer-events: auto; }
        .icing { position: absolute; top: 0; left: 0; width: 100%; height: 35px; background: #f472b6; border-radius: 10px 10px 20px 20px; }
        .candles-container { display: flex; gap: 20px; margin-bottom: -5px; z-index: 10; align-items: flex-end; }
        .candle { width: 12px; height: 45px; background: #fff; position: relative; cursor: pointer; border-radius: 2px; pointer-events: auto; }
        .flame { width: 14px; height: 24px; background: #fbbf24; border-radius: 50% 50% 20% 20%; position: absolute; top: -24px; left: -1px; animation: flicker 0.6s infinite alternate; box-shadow: 0 0 20px #f59e0b; transform-origin: center bottom; }
        .flame.out { animation: none; opacity: 0; transform: scale(0); transition: all 0.3s ease-out; }
        @keyframes flicker { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.1); opacity: 0.8; } }

        #loader { background: #000; position: fixed; inset: 0; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; }

    </style>
</head>
<body>

    <div class="film-grain"></div>
    <div class="ambient-glow"></div>
    <div id="cursor-dot"></div>
    <div id="floating-words-container"></div> 

    <audio id="bg-music" loop preload="auto"><source src="songs1/love12.mp3" type="audio/mpeg"></audio>
    <canvas id="bg-canvas" style="position: fixed; top:0; left:0; z-index:-2;"></canvas>

    <!-- Loader -->
    <div id="loader">
        <div class="text-pink-400 text-4xl animate-pulse">‚ù§</div>
        <p class="text-pink-200 font-light tracking-[0.4em] text-[10px] uppercase">Gathering Memories...</p>
    </div>

    <!-- Intro -->
    <div id="intro-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-1000 hidden">
        <p class="text-pink-300 handwritten text-3xl mb-4 opacity-80 breathe-text">For my soulmate,</p>
        <h1 class="text-6xl md:text-8xl text-transparent bg-clip-text bg-gradient-to-b from-white to-pink-300 mb-8 tracking-tight heartbeat-glow font-serif">Nayanika</h1>
        <p class="text-gray-500 text-[10px] uppercase tracking-[0.3em] mb-12">Headphones Recommended</p>
        <button onclick="startJourney()" class="soul-btn">Enter My Heart</button>
    </div>

    <!-- Main Stage -->
    <div id="main-stage" class="glass-panel opacity-0 transition-opacity duration-1000 hidden">

        <!-- Progress -->
        <div class="absolute top-0 left-0 w-full h-1 bg-white/5 z-30">
            <div id="progress" class="h-full bg-pink-600 w-0 transition-all duration-1000 shadow-[0_0_15px_#db2777]"></div>
        </div>

        <!-- CHAP 1: Intro -->
        <div id="chap-1" class="chapter-container chapter-active">
            <div class="w-56 h-56 md:w-72 md:h-72 mb-8 p-3 border border-white/10 rounded-full bg-white/5 backdrop-blur-md shadow-2xl memory-photo relative">
                <div class="absolute inset-0 rounded-full border border-pink-500/20 animate-pulse"></div>
                <img src="New folder (3)/mylove1.jpg" class="w-full h-full object-cover rounded-full opacity-90">
            </div>
            <h2 class="text-4xl md:text-6xl text-white mb-6 italic font-light breathe-text text-center">The Day The World Changed</h2>
            <div class="emotional-text text-center space-y-4 max-w-lg text-sm md:text-lg font-light text-gray-300">
                <p>Before you, I didn't realize how loud the world was.</p>
                <p>Then you walked in...</p>
                <p class="text-pink-200 italic font-serif text-2xl mt-4">And everything became a melody.</p>
            </div>
            <button onclick="nextChapter()" class="soul-btn">Begin Our Story</button>
        </div>

        <!-- CHAP 2: Timeline -->
        <div id="chap-2" class="chapter-container">
            <h2 class="text-4xl text-pink-100 mb-8 font-serif italic">How Stars Aligned</h2>
            <div class="relative h-[50vh] w-full max-w-md overflow-y-auto custom-scroll flex flex-col items-center pt-4 pb-20 pointer-events-auto">
                <div class="absolute left-1/2 transform -translate-x-1/2 w-px h-full bg-gradient-to-b from-transparent via-pink-500/50 to-transparent"></div>
                <!-- Nodes -->
                <div class="timeline-node glass-card relative z-10 text-center p-6 m-4 w-64 transform hover:scale-105 transition-all duration-300 cursor-pointer">
                    <p class="text-[10px] text-pink-400 uppercase tracking-widest mb-2">The Beginning</p>
                    <p class="text-white font-serif text-lg">Strangers became destiny.</p>
                </div>
                <div class="timeline-node glass-card relative z-10 text-center p-6 m-4 w-64 transform hover:scale-105 transition-all duration-300 cursor-pointer">
                    <p class="text-[10px] text-pink-400 uppercase tracking-widest mb-2">24 May</p>
                    <p class="text-white font-serif text-lg italic">"The day you stayed."</p>
                </div>
                <div class="timeline-node glass-card relative z-10 text-center p-6 m-4 w-64 transform hover:scale-105 transition-all duration-300 cursor-pointer">
                    <p class="text-[10px] text-pink-400 uppercase tracking-widest mb-2">Today</p>
                    <p class="text-white font-serif text-lg">Celebrating You.</p>
                </div>
            </div>
            <button onclick="nextChapter()" class="soul-btn">Continue</button>
        </div>

        <!-- CHAP 3: Memories Gallery -->
        <div id="chap-3" class="chapter-container">
            <h2 class="text-3xl text-pink-100 mb-4 font-serif">Moments I Replay</h2>
            <div id="gallery-stage" class="relative w-full h-[45vh] flex justify-center items-center perspective-[1000px]"></div>
            <p id="gallery-caption" class="breathe-text px-4 text-center min-h-[60px] text-xl font-serif italic text-pink-200"></p>
            <button id="gallery-btn" onclick="revealNextMemory()" class="soul-btn">Next Memory</button>
        </div>

        <!-- CHAP 4: FUNNY PHOTOS (NEW) -->
        <div id="chap-4" class="chapter-container">
            <h2 class="text-4xl text-pink-200 mb-2 font-serif">The Giggle Gallery</h2>
            <p class="text-xs text-gray-400 mb-8 tracking-widest uppercase">Because your smile is my favorite</p>
            <div class="funny-grid pointer-events-auto">
                <div class="funny-item" style="--rot: -5deg"><img src="New folder (3)/funny1.jpg"></div>
                <div class="funny-item" style="--rot: 8deg"><img src="New folder (3)/funny2.jpg"></div>
                <div class="funny-item" style="--rot: -3deg"><img src="New folder (3)/funny3.jpg"></div>
                <div class="funny-item" style="--rot: 6deg"><img src="New folder (3)/funny4.jpg"></div>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-8">Enough Giggles!</button>
        </div>

        <!-- CHAP 5: Hidden Letters -->
        <div id="chap-5" class="chapter-container">
            <h2 class="text-4xl text-white mb-8 font-serif">Things I Never Told You</h2>
            <div class="secret-grid grid grid-cols-2 gap-4 w-full max-w-lg pointer-events-auto">
                <div class="secret-note glass-card p-6 cursor-pointer group relative overflow-hidden" onclick="revealSecret(this)">
                    <div class="absolute inset-0 bg-pink-900/20 group-hover:bg-pink-900/30 transition"></div>
                    <p class="text-pink-200 font-serif italic text-center blur-sm group-hover:blur-none transition-all duration-700">"When you're sad, my heart breaks."</p>
                    <span class="absolute bottom-2 left-1/2 -translate-x-1/2 text-[9px] uppercase tracking-widest text-white/50 note-hint">Touch</span>
                </div>
                <div class="secret-note glass-card p-6 cursor-pointer group relative overflow-hidden" onclick="revealSecret(this)">
                    <div class="absolute inset-0 bg-pink-900/20 group-hover:bg-pink-900/30 transition"></div>
                    <p class="text-pink-200 font-serif italic text-center blur-sm group-hover:blur-none transition-all duration-700">"Your voice is my favorite sound."</p>
                    <span class="absolute bottom-2 left-1/2 -translate-x-1/2 text-[9px] uppercase tracking-widest text-white/50 note-hint">Touch</span>
                </div>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-8">Go Deeper</button>
        </div>

        <!-- CHAP 6: Infinite Reasons -->
        <div id="chap-6" class="chapter-container">
            <h2 class="text-3xl text-pink-100 mb-4 font-serif">Why It's You</h2>
            <div class="h-[40vh] w-full relative flex flex-col items-center justify-center mask-image-gradient">
                <div class="text-center space-y-6 animate-scroll-up">
                    <p class="text-xl text-white/60 font-light">Your Kindness</p>
                    <p class="text-3xl text-pink-300 font-serif italic">Your Laugh</p>
                    <p class="text-xl text-white/60 font-light">The way you look at me</p>
                    <p class="text-3xl text-pink-300 font-serif italic">Your Voice at 11 PM</p>
                    <p class="text-xl text-white/60 font-light">Just being You</p>
                </div>
            </div>
            <button onclick="nextChapter()" class="soul-btn">My Heart</button>
        </div>

        <!-- CHAP 7: Love Letter -->
        <div id="chap-7" class="chapter-container">
            <div id="letter-closed" class="envelope-container flex flex-col items-center" onclick="openLetter()">
                <div class="w-72 h-48 bg-[#9d174d] rounded-lg shadow-2xl flex items-center justify-center relative border-t-2 border-white/10">
                    <div class="wax-seal absolute"><span class="text-2xl">‚ù§</span></div>
                    <div class="absolute -top-10 text-white font-serif italic text-2xl">For Nayanika</div>
                </div>
                <p class="text-[10px] text-white/50 mt-6 uppercase tracking-[0.3em] animate-pulse">Touch to Open</p>
            </div>
            <div id="letter-content" class="letter-paper custom-scroll">
                <p class="text-xl font-serif italic leading-relaxed text-gray-800">
                    My Dearest Nayanika, <br><br>
                    I write this because sometimes spoken words vanish into the air, but written ones stay.<br><br>
                    "Nayanika" isn't just a name. To me, it means <b>Home</b>. It means <b>Peace</b>. <br><br>
                    Thank you for the 24th of May. Thank you for choosing me every single day. Even when I am difficult, you are patient. Even when the world is loud, you are my quiet.<br><br>
                    I love you more than this code can ever express.<br><br>
                    Forever yours,<br>
                    <b>(Your Name)</b>
                </p>
                <div class="w-full flex justify-center mt-8">
                    <button onclick="nextChapter()" class="px-8 py-3 rounded-full border border-pink-900 text-pink-900 uppercase text-xs tracking-widest hover:bg-pink-900 hover:text-white transition duration-500">My Promises</button>
                </div>
            </div>
        </div>

        <!-- CHAP 8: PROMISES -->
        <div id="chap-8" class="chapter-container">
            <h2 class="text-3xl md:text-5xl text-pink-100 mb-6 font-serif italic">My Promises to You</h2>
            
            <div id="promise-card" class="relative w-full max-w-sm aspect-[4/5] bg-black/20 rounded-xl border border-white/10 overflow-hidden shadow-[0_0_50px_rgba(0,0,0,0.5)]">
                <div id="promise-flash" class="absolute inset-0 bg-white opacity-0 pointer-events-none z-20"></div>
                <img id="promise-img" src="" class="absolute inset-0 w-full h-full object-cover opacity-80 transition-transform duration-[10s] ease-linear scale-100">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-90"></div>
                <div class="absolute bottom-0 p-8 text-center w-full z-10">
                    <p id="promise-text" class="text-white text-xl font-serif italic mb-3 leading-snug drop-shadow-md translate-y-4 opacity-0"></p>
                    <p id="promise-sub" class="text-pink-200/80 text-xs font-sans tracking-wide leading-relaxed translate-y-4 opacity-0"></p>
                </div>
            </div>
            
            <p id="promise-counter" class="text-[10px] text-white/30 mt-6 tracking-[0.3em]">1 / 18</p>
            <button id="btn-promise-next" onclick="nextPromise()" class="soul-btn mt-2">Next Promise</button>
        </div>

        <!-- CHAP 9: EXTRA SURPRISE (NEW) -->
        <div id="chap-9" class="chapter-container">
            <h2 class="text-4xl text-white mb-6 font-serif">A Little Surprise</h2>
            <div id="surprise-box" class="w-48 h-48 bg-pink-900/30 border border-pink-500/50 rounded-lg flex items-center justify-center cursor-pointer shadow-[0_0_50px_rgba(236,72,153,0.3)] hover:scale-105 transition duration-500 pointer-events-auto relative group" onclick="openSurprise()">
                <div class="absolute inset-0 bg-pink-600/20 blur-xl opacity-0 group-hover:opacity-100 transition duration-700"></div>
                <span class="text-5xl group-hover:scale-110 transition duration-300">üéÅ</span>
            </div>
            
            <!-- Hidden Content Container -->
            <div id="surprise-content" class="hidden flex-col items-center max-w-md text-center bg-black/80 p-6 rounded-xl border border-pink-500/30 backdrop-blur-xl">
                <img src="New folder (3)/surprise_box.jpg" class="w-full h-48 object-cover rounded-lg mb-4 border border-white/20">
                <p class="text-pink-200 font-serif italic text-lg">"Just like this box, my heart is full of surprises for you. I kept this photo just for today."</p>
                <button onclick="nextChapter()" class="soul-btn mt-4">Continue</button>
            </div>
        </div>

        <!-- CHAP 10: Future Vow -->
        <div id="chap-10" class="chapter-container">
            <div class="max-w-xl text-center px-4">
                <h1 class="text-5xl md:text-7xl text-white mb-8 font-serif leading-tight">"A Future With You."</h1>
                <p class="text-pink-200/80 text-lg font-light">I see us growing up. I see us growing old.</p>
                <p class="text-white/60 text-sm mt-4 tracking-widest uppercase">In every lifetime, I will find you.</p>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-12">Make a Wish</button>
        </div>

        <!-- CHAP 11: Cake -->
        <div id="chap-11" class="chapter-container">
            <h2 class="text-4xl text-white mb-2 handwritten">Happy Birthday, Sunu</h2>
            <p id="cake-instruction" class="text-[10px] tracking-[0.3em] text-pink-400 uppercase mb-12 animate-pulse">Make a wish & Blow the candles</p>
            <div id="cake-section" class="flex flex-col items-center relative scale-125">
                <div class="candles-container">
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                </div>
                <div class="cake-body" onclick="cutCake()">
                    <div class="icing"></div>
                    <span class="text-pink-900/10 text-4xl font-bold select-none z-10">üéÇ</span>
                </div>
            </div>
        </div>

        <!-- CHAP 12: Finale -->
        <div id="chap-12" class="chapter-container">
            <div class="relative group cursor-pointer perspective-[1000px] mb-8">
                <div class="absolute -inset-10 bg-pink-600/20 blur-3xl rounded-full opacity-0 group-hover:opacity-100 transition duration-1000"></div>
                <img src="New folder (3)/surprise.jpg" id="final-img" class="relative w-72 md:w-96 rounded-lg border border-white/10 shadow-2xl transform scale-90 opacity-0 rotate-1">
            </div>
            <div class="h-32 w-full flex items-center justify-center px-4">
                <h1 id="typewriter" class="text-2xl md:text-4xl text-pink-100 font-serif italic text-center leading-relaxed"></h1>
            </div>
            <p class="text-white/40 text-[10px] mt-12 tracking-widest uppercase">Forever Yours.</p>
        </div>

    </div>

    <!-- Controls -->
    <div onclick="toggleMusic()" class="fixed bottom-8 right-8 text-white/50 hover:text-white cursor-pointer z-50 transition p-3 bg-black/40 rounded-full backdrop-blur-md border border-white/10">
        <span id="music-status" class="text-xs uppercase tracking-widest">üîá Music</span>
    </div>

    <script>
        // --- SETUP ---
        gsap.registerPlugin(TextPlugin);
        const cursorDot = document.getElementById("cursor-dot");
        document.addEventListener("mousemove", (e) => {
            cursorDot.style.left = e.clientX + "px"; cursorDot.style.top = e.clientY + "px";
            if(Math.random() > 0.95) createSparkle(e.clientX, e.clientY);
        });
        function createSparkle(x, y) {
            const s = document.createElement("div"); s.classList.add("sparkle"); document.body.appendChild(s);
            const size = Math.random() * 3 + 1; s.style.width = `${size}px`; s.style.height = `${size}px`;
            s.style.left = `${x}px`; s.style.top = `${y}px`;
            setTimeout(() => { s.remove(); }, 1000);
        }

        // --- FLOATING WORDS ---
        const loveWords = ["Sunu", "Love", "Forever", "24 May", "Nayanika", "Peace", "Home", "Mine", "Heart", "Soul", "Infinity", "Us", "Magic"];
        function createWord(isInitial = false) {
            const container = document.getElementById('floating-words-container');
            const word = document.createElement('div');
            word.innerText = loveWords[Math.floor(Math.random() * loveWords.length)];
            word.className = "floating-word";
            word.style.left = Math.random() * 100 + "vw";
            word.style.fontSize = (Math.random() * 2 + 1) + "rem";
            const duration = Math.random() * 15 + 20;
            word.style.animationDuration = duration + "s";
            if(isInitial) word.style.animationDelay = -(Math.random() * duration) + "s";
            container.appendChild(word);
            setTimeout(() => { word.remove(); }, duration * 1000);
        }
        for(let i=0; i<20; i++) createWord(true);
        setInterval(() => createWord(false), 1500);

        // --- AUDIO ---
        const audio = document.getElementById('bg-music');
        let musicPlaying = false;
        function toggleMusic() {
            const status = document.getElementById("music-status");
            if(musicPlaying) { audio.pause(); status.innerText = "üîá Music"; } 
            else { audio.play().then(() => { status.innerText = "üîä Playing"; }).catch(e => { alert("Touch screen first!"); }); }
            musicPlaying = !musicPlaying;
        }

        // --- NAVIGATION STATE ---
        let currentChap = 1;
        const totalChap = 12; 
        
        // --- LOAD SEQUENCE ---
        window.onload = () => {
            gsap.to("#loader", { opacity: 0, duration: 1.5, delay: 1, onComplete: () => {
                document.getElementById("loader").style.display = "none";
                document.getElementById("intro-screen").classList.remove("hidden");
                initParticles();
            }});
        };

        function startJourney() {
            gsap.to("#intro-screen", { opacity: 0, duration: 2, onComplete: () => {
                document.getElementById("intro-screen").style.display = "none";
                document.getElementById("main-stage").classList.remove("hidden");
                gsap.to("#main-stage", { opacity: 1, duration: 2 });
                audio.volume = 0.6; audio.play().catch(()=>{});
                musicPlaying = true; document.getElementById("music-status").innerText = "üîä Playing";
                animateElements(1);
            }});
        }

        function nextChapter() {
            const curr = document.getElementById(`chap-${currentChap}`);
            const next = document.getElementById(`chap-${currentChap+1}`);
            
            if(curr) curr.style.pointerEvents = "none";

            gsap.to("#progress", { width: `${(currentChap/totalChap)*100}%`, duration: 1.5, ease: "power2.inOut" });
            gsap.to(curr, { opacity: 0, y: -30, filter: "blur(10px)", duration: 1, ease: "power2.in", onComplete: () => {
                curr.classList.remove("chapter-active");
                if(next) {
                    next.classList.add("chapter-active");
                    next.style.pointerEvents = "auto"; 
                    gsap.fromTo(next, { opacity: 0, y: 40, filter: "blur(10px)" }, { opacity: 1, y: 0, filter: "blur(0px)", duration: 1.2, ease: "power2.out" });
                    
                    currentChap++;
                    animateElements(currentChap);
                    
                    // Specific Logic
                    if(currentChap === 3 && mIdx === 0) revealNextMemory();
                    if(currentChap === 8) loadPromise(0);
                    if(currentChap === 12) revealFinale();
                }
            }});
        }

        function animateElements(id) {
            let fadeDur = 1.5; let stag = 0.2; let delay = 1.5;
            if (id === 1) { fadeDur = 4; stag = 0.8; delay = 5; } // Slow Intro
            
            gsap.fromTo(`#chap-${id} h2, #chap-${id} h1, #chap-${id} .memory-photo`, 
                { opacity: 0, y: 30 }, { opacity: 1, y: 0, duration: fadeDur, ease: "power3.out" });
            
            gsap.fromTo(`#chap-${id} p, #chap-${id} .emotional-text`, 
                { opacity: 0 }, { opacity: 1, duration: fadeDur, delay: 0.5, stagger: stag });

            gsap.fromTo(`#chap-${id} .soul-btn`, 
                { opacity: 0, scale: 0.9 }, { opacity: 1, scale: 1, duration: 1, delay: delay, ease: "back.out(1.7)" });
            
            if(id === 2) gsap.fromTo(".timeline-node", {opacity: 0, x: -30}, {opacity: 1, x: 0, duration: 1, stagger: 0.4, delay: 0.5});
        }

        // --- INTERACTIONS ---
        function revealSecret(el) { el.classList.add("secret-revealed"); el.querySelector(".note-hint").style.display = "none"; }
        
        function openLetter() {
            gsap.to("#letter-closed", { scale: 1.5, opacity: 0, duration: 0.8, onComplete: () => {
                document.getElementById("letter-closed").style.display = "none";
                const content = document.getElementById("letter-content");
                content.style.display = "flex";
                gsap.fromTo(content, { opacity: 0, y: 50 }, { opacity: 1, y: 0, duration: 1 });
            }});
        }

        function openSurprise() {
            gsap.to("#surprise-box", { scale: 1.5, opacity: 0, duration: 0.5, onComplete: () => {
                document.getElementById("surprise-box").style.display = "none";
                const content = document.getElementById("surprise-content");
                content.classList.remove("hidden"); content.classList.add("flex");
                gsap.fromTo(content, { scale: 0.5, opacity: 0 }, { scale: 1, opacity: 1, duration: 1, ease: "elastic.out(1, 0.75)" });
                // Confetti Burst
                confetti({ particleCount: 50, spread: 70, origin: { y: 0.6 } });
            }});
        }

        // --- PROMISES ---
        const promises = [
            { text: "I promise to stay even when it‚Äôs difficult.", sub: "Not just in the beautiful moments... but in the messy ones too.", img: "New folder (3)/promise1.jpg" },
            { text: "I promise to love you the way you deserve.", sub: "Every single day. Even when life gets heavy.", img: "New folder (3)/promise2.jpg" },
            { text: "I promise to listen to the words you don‚Äôt say.", sub: "Your silence. Your tone. I‚Äôll hear everything.", img: "New folder (3)/promise3.jpg" },
            { text: "I promise to protect your heart like it‚Äôs my own.", sub: "Because hurting you would mean hurting myself.", img: "New folder (3)/promise4.jpg" },
            { text: "I promise to never let you feel alone.", sub: "Even if we fight. Even if we‚Äôre far away.", img: "New folder (3)/promise5.jpg" },
            { text: "I promise to choose you again in every lifetime.", sub: "Intentionally. Every single time.", img: "New folder (3)/promise6.jpg" },
            { text: "I promise to hold your hand through every fear.", sub: "No storm will ever make me let go.", img: "New folder (3)/promise7.jpg" },
            { text: "I promise to be your peace.", sub: "The place you come to when the world gets too loud.", img: "New folder (3)/promise8.jpg" },
            { text: "I promise to treasure your smile.", sub: "It is the most precious thing I own.", img: "New folder (3)/promise9.jpg" },
            { text: "I promise to grow with you, not away from you.", sub: "As we change, we will change together.", img: "New folder (3)/promise10.jpg" },
            { text: "I promise to always come back after every fight.", sub: "No argument is bigger than 'us'.", img: "New folder (3)/promise11.jpg" },
            { text: "I promise to support your dreams.", sub: "Your success will always feel like my victory too.", img: "New folder (3)/promise12.jpg" },
            { text: "I promise to love the sides you hide.", sub: "Even the ones you think are unlovable.", img: "New folder (3)/promise13.jpg" },
            { text: "I promise to make you feel important.", sub: "Because you are my world.", img: "New folder (3)/promise14.jpg" },
            { text: "I promise to stay loyal.", sub: "In heart, in words, in actions.", img: "New folder (3)/promise15.jpg" },
            { text: "I promise to be gentle with your feelings.", sub: "You matter more than any ego.", img: "New folder (3)/promise16.jpg" },
            { text: "I promise to give you reasons to trust me.", sub: "Every single day.", img: "New folder (3)/promise17.jpg" },
            { text: "I promise to make you feel loved, always.", sub: "Not sometimes. Not occasionally. Always.", img: "New folder (3)/promise18.jpg" }
        ];

        let pIdx = 0;
        function loadPromise(idx) {
            const img = document.getElementById('promise-img');
            const txt = document.getElementById('promise-text');
            const sub = document.getElementById('promise-sub');
            const flash = document.getElementById('promise-flash');

            // Flash Effect
            gsap.fromTo(flash, { opacity: 0.8 }, { opacity: 0, duration: 0.8 });

            // Text Change
            txt.innerText = promises[idx].text;
            sub.innerText = promises[idx].sub;
            document.getElementById('promise-counter').innerText = `${idx + 1} / 18`;

            // Image Change & Animation
            img.src = promises[idx].img;
            gsap.fromTo(img, { scale: 1.1, filter: "blur(5px)" }, { scale: 1, filter: "blur(0px)", duration: 2, ease: "power2.out" });
            
            // Text Entry
            gsap.fromTo([txt, sub], { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: 1, delay: 0.2, stagger: 0.1 });
        }

        function nextPromise() {
            if (pIdx < promises.length - 1) {
                pIdx++;
                loadPromise(pIdx);
                if (pIdx === promises.length - 1) {
                    const btn = document.getElementById('btn-promise-next');
                    btn.innerText = "Time for a Surprise";
                    btn.onclick = nextChapter; 
                }
            }
        }

        // --- CAKE & FINALE ---
        let candlesOut = 0;
        function blowCandle(el) {
            const flame = el.querySelector('.flame');
            if(flame && !flame.classList.contains('out')) {
                flame.classList.add('out'); candlesOut++;
                const puff = document.createElement("div"); puff.innerText = "üí®";
                puff.style.position = "absolute"; puff.style.top = "-40px"; puff.style.left = "0"; puff.style.color = "white"; puff.style.animation = "fadeAndScale 1s forwards";
                el.appendChild(puff);
                if(candlesOut === 3) {
                    document.getElementById("cake-instruction").innerText = "Make a wish & Cut the cake";
                    gsap.to(".cake-body", { scale: 1.05, yoyo: true, repeat: -1, duration: 0.5 });
                }
            }
        }
        function cutCake() {
            if(candlesOut < 3) return;
            gsap.killTweensOf(".cake-body");
            nextChapter(); // Goes to Finale (Chap 12)
        }

        function revealFinale() {
            const colors = ['#fbcfe8', '#f472b6', '#db2777'];
            const end = Date.now() + 5000;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());

            gsap.fromTo("#final-img", { scale: 0.8, opacity: 0, rotation: -5 }, { scale: 1, opacity: 1, rotation: 0, duration: 3, ease: "elastic.out(1, 0.5)" });
            gsap.to("#typewriter", { text: "Happy Birthday, Nayanika. You are my answered prayer. ‚ù§Ô∏è", duration: 5, delay: 1, ease: "none" });
            if(musicPlaying) gsap.to(audio, { volume: 1, duration: 3 });
        }

        // --- GALLERY ---
        const memories = [
            { src: "New folder (3)/mylove1.jpg", text: "Your smile makes my winter warm.", btn: "Next" },
            { src: "New folder (3)/mylove2.jpg", text: "Eyes that hold my entire universe.", btn: "Next" },
            { src: "New folder (3)/mylove3.jpg", text: "I want to live in this moment forever.", btn: "Next" },
            { src: "New folder (3)/mylove4.jpg", text: "Elegance isn't what you wear, it's you.", btn: "Next" },
            { src: "New folder (3)/sur1.jpg", text: "Even in chaos, you are my calm.", btn: "Next" },
            { src: "New folder (3)/sur2.jpg", text: "Your laugh heals my broken parts.", btn: "Next" },
            { src: "New folder (3)/sur3.jpg", text: "My favorite view in the world.", btn: "Next" },
            { src: "New folder (3)/sur4.jpg", text: "Us. My favorite story.", btn: "Let's Laugh" }
        ];
        let mIdx = 0;
        function revealNextMemory() {
            if (mIdx >= memories.length) { nextChapter(); return; }
            const stage = document.getElementById("gallery-stage");
            const data = memories[mIdx];
            
            // Move old
            stage.querySelectorAll(".polaroid").forEach(p => {
                const rot = (Math.random() - 0.5) * 40; const x = (Math.random() - 0.5) * 400;
                gsap.to(p, { x: x, rotation: rot, scale: 0.8, opacity: 0.5, duration: 1 });
            });

            // New
            const div = document.createElement("div"); div.className = "polaroid absolute bg-white p-2 shadow-2xl w-64 transform transition duration-500";
            div.innerHTML = `<img src="${data.src}" class="w-full h-80 object-cover">`;
            stage.appendChild(div);
            gsap.fromTo(div, { scale: 0, rotation: Math.random()*20-10 }, { scale: 1, rotation: Math.random()*6-3, duration: 1, ease: "back.out" });
            
            gsap.to("#gallery-caption", { opacity: 0, onComplete: () => {
                document.getElementById("gallery-caption").innerText = `"${data.text}"`;
                gsap.to("#gallery-caption", { opacity: 1 });
            }});
            document.getElementById("gallery-btn").innerText = data.btn;
            mIdx++;
        }

        // --- BACKGROUND ---
        function initParticles() {
            const canvas = document.getElementById('bg-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            const geometry = new THREE.BufferGeometry();
            const count = 300; const pos = new Float32Array(count*3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*15;
            geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const material = new THREE.PointsMaterial({ size: 0.03, color: 0xfbcfe8, transparent: true, opacity: 0.6 });
            const points = new THREE.Points(geometry, material);
            scene.add(points);
            camera.position.z = 5;
            function animate() {
                requestAnimationFrame(animate);
                points.rotation.y += 0.0005; points.position.y += Math.sin(Date.now()*0.001)*0.001;
                renderer.render(scene, camera);
            }
            animate();
            window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        }
    </script>
</body>
</html>
