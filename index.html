<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Nayanika ‚ù§Ô∏è</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Montserrat:wght@200;300;400&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script> <!-- Restored Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- CORE STYLES --- */
        body {
            margin: 0; overflow: hidden; background-color: #050203; 
            font-family: 'Montserrat', sans-serif; color: #e5e5e5;
            cursor: none; user-select: none;
        }

        /* Custom Cursor */
        #cursor-dot {
            width: 8px; height: 8px; background: #f472b6; border-radius: 50%;
            position: fixed; pointer-events: none; z-index: 9999;
            box-shadow: 0 0 10px #f472b6; transition: transform 0.1s;
        }
        .sparkle {
            position: fixed; pointer-events: none; z-index: 9998;
            background: white; border-radius: 50%; animation: fadeAndScale 1s linear forwards;
        }
        @keyframes fadeAndScale { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

        /* Floating Words Background */
        .floating-word {
            position: absolute; color: rgba(244, 114, 182, 0.15); font-family: 'Dancing Script', cursive;
            font-size: 1.5rem; pointer-events: none; z-index: 0;
            animation: floatUp 15s linear infinite;
        }
        @keyframes floatUp { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 20% { opacity: 0.8; } 80% { opacity: 0.8; } 100% { transform: translateY(-10vh) rotate(20deg); opacity: 0; } }

        /* Typography & Animations */
        h1, h2, h3 { font-family: 'Cormorant Garamond', serif; font-weight: 600; }
        .handwritten { font-family: 'Dancing Script', cursive; }
        .breathe-text { animation: breathe 4s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { opacity: 0.9; transform: scale(1); } 50% { opacity: 1; transform: scale(1.02); text-shadow: 0 0 15px rgba(255,255,255,0.2); } }
        .heartbeat-glow { animation: heartbeat 2s infinite; display: inline-block; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); text-shadow: 0 0 10px rgba(244,114,182,0.5); } 50% { transform: scale(1.05); text-shadow: 0 0 25px rgba(244,114,182,0.9); } }

        /* Glass Panel */
        .glass-panel {
            background: rgba(15, 10, 12, 0.6); backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05); box-shadow: 0 0 50px rgba(0,0,0,0.9);
            width: 100%; height: 100vh; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .chapter-container {
            position: absolute; inset: 0; padding: 1.5rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; text-align: center; z-index: 10;
            transition: visibility 0s linear 1s, opacity 1s; /* Smooth handling of visibility */
        }
        .chapter-active { opacity: 1; visibility: visible; z-index: 20; transition-delay: 0s; }

        /* --- TIMELINE STYLES --- */
        .timeline-line {
            width: 2px; height: 100%; background: linear-gradient(to bottom, transparent, #f472b6, transparent);
            position: absolute; left: 50%; transform: translateX(-50%); opacity: 0.3;
        }
        .timeline-node {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(244, 114, 182, 0.3);
            padding: 15px; border-radius: 8px; width: 260px; margin: 10px 0;
            backdrop-filter: blur(5px); transition: transform 0.3s;
        }
        .timeline-node:hover { transform: scale(1.05); border-color: #f472b6; background: rgba(244, 114, 182, 0.1); }

        /* --- HIDDEN NOTES STYLES --- */
        .secret-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 500px; }
        .secret-note {
            background: rgba(255,255,255,0.03); border: 1px dashed rgba(255,255,255,0.2);
            padding: 20px; border-radius: 4px; cursor: pointer; position: relative; overflow: hidden;
            height: 100px; display: flex; align-items: center; justify-content: center;
            transition: all 0.5s ease;
        }
        .secret-blur { filter: blur(6px); opacity: 0.6; transition: all 0.8s ease; }
        .secret-note:hover .secret-blur { opacity: 0.8; }
        .secret-revealed { background: rgba(244, 114, 182, 0.1); border-style: solid; border-color: #f472b6; }
        .secret-revealed .secret-blur { filter: blur(0); opacity: 1; }
        .note-hint { position: absolute; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: #f472b6; bottom: 5px; }

        /* --- INTERACTIVE HEART --- */
        #interactive-heart { font-size: 5rem; cursor: pointer; transition: transform 0.2s; filter: drop-shadow(0 0 20px rgba(220, 38, 38, 0.6)); pointer-events: auto; }
        #interactive-heart:active { transform: scale(0.9); }
        .heart-message { opacity: 0; transform: translateY(10px); transition: all 0.5s; font-family: 'Dancing Script'; font-size: 1.5rem; color: #fbcfe8; margin-top: 15px; }

        /* --- GALLERY STYLES --- */
        #gallery-stage { position: relative; width: 100%; height: 40vh; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
        .polaroid { position: absolute; background: white; padding: 10px 10px 30px 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 220px; transition: all 1s ease; }
        .polaroid img { width: 100%; aspect-ratio: 4/5; object-fit: cover; }
        .polaroid.active { z-index: 50; transform: scale(1.1) rotate(0deg) !important; filter: drop-shadow(0 0 20px rgba(236, 72, 153, 0.6)); }
        .polaroid.bg { z-index: 1; opacity: 0.3; filter: blur(2px) grayscale(50%); }

        /* --- FIXED LOVE LETTER & SCROLL --- */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
        .custom-scroll::-webkit-scrollbar-thumb { background: #be185d; border-radius: 10px; }
        .custom-scroll { scrollbar-width: thin; scrollbar-color: #be185d transparent; }

        /* High Z-Index for Envelope to ensure clickability */
        .envelope-container { 
            cursor: pointer; transition: transform 0.3s; z-index: 100; position: relative; 
            pointer-events: auto; /* Forces clicks to register */
        } 
        .envelope-container:hover { transform: scale(1.05); }
        .wax-seal { width: 60px; height: 60px; background: #9f1239; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 2px solid #be123c; color: white; font-size: 24px; z-index: 20; }
        
        .letter-paper { 
            background: #fff1f2; color: #831843; width: 90%; max-width: 500px; 
            max-height: 65vh; padding: 2rem; border-radius: 4px; overflow-y: auto; 
            text-align: left; box-shadow: 0 0 20px rgba(0,0,0,0.5); position: relative; z-index: 60;
            display: none; flex-direction: column; pointer-events: auto;
        }

        /* --- CAKE & UI --- */
        .cake-body { width: 180px; height: 100px; background: #fce7f3; border-radius: 10px 10px 0 0; position: relative; display: flex; align-items: center; justify-content: center; cursor: pointer; pointer-events: auto; }
        .icing { position: absolute; top: 0; left: 0; width: 100%; height: 35px; background: #f472b6; border-radius: 10px 10px 20px 20px; }
        .candles-container { display: flex; gap: 20px; margin-bottom: -5px; z-index: 10; align-items: flex-end; }
        .candle { width: 12px; height: 45px; background: #fff; position: relative; cursor: pointer; border-radius: 2px; pointer-events: auto; }
        .candle::after { content: ''; position: absolute; inset: -10px; z-index: 20; } 
        .flame { width: 14px; height: 24px; background: #fbbf24; border-radius: 50% 50% 20% 20%; position: absolute; top: -24px; left: -1px; animation: flicker 0.6s infinite alternate; box-shadow: 0 0 15px #f59e0b; transform-origin: center bottom; }
        .flame.out { animation: none; opacity: 0; transform: scale(0); transition: all 0.3s ease-out; }
        @keyframes flicker { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.1); opacity: 0.8; } }

        .soul-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.3); color: rgba(255,255,255,0.9);
            padding: 12px 30px; font-family: 'Montserrat', sans-serif; font-size: 0.75rem; letter-spacing: 2px;
            text-transform: uppercase; transition: all 0.5s ease; position: relative; overflow: hidden; cursor: pointer;
            margin-top: 20px; z-index: 50; pointer-events: auto;
        }
        .soul-btn:hover { border-color: #f472b6; color: #fff; box-shadow: 0 0 20px rgba(244, 114, 182, 0.3); background: rgba(244, 114, 182, 0.1); }
        
        #loader { background: #000; position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; }

    </style>
</head>
<body>

    <!-- Cursor & Effects -->
    <div id="cursor-dot"></div>
    <div id="floating-words-container"></div> 

    <!-- Audio -->
    <audio id="bg-music" loop preload="auto">
        <source src="songs1/love12.mp3" type="audio/mpeg">
    </audio>

    <!-- Background 3D Particles -->
    <canvas id="bg-canvas" style="position: fixed; top:0; left:0; z-index:-2;"></canvas>

    <!-- Loader -->
    <div id="loader">
        <p class="text-white font-light tracking-[0.5em] text-xs uppercase animate-pulse">Gathering Every Moment...</p>
    </div>

    <!-- Intro Screen -->
    <div id="intro-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-1000 hidden">
        <p class="text-pink-300 handwritten text-3xl mb-4 opacity-80 breathe-text">For my soulmate,</p>
        <h1 class="text-5xl md:text-7xl text-white mb-8 tracking-wide heartbeat-glow">Nayanika</h1>
        <p class="text-gray-500 text-xs uppercase tracking-widest mb-12">Please wear headphones</p>
        <button onclick="startJourney()" class="soul-btn">Open My Heart</button>
    </div>

    <!-- Main Stage -->
    <div id="main-stage" class="glass-panel opacity-0 transition-opacity duration-1000 hidden">

        <!-- Progress Bar -->
        <div class="absolute top-6 left-1/2 transform -translate-x-1/2 w-32 h-0.5 bg-white/10 rounded-full overflow-hidden z-30">
            <div id="progress" class="h-full bg-pink-500 w-0 transition-all duration-1000"></div>
        </div>

        <!-- CHAP 1: Intro -->
        <div id="chap-1" class="chapter-container chapter-active">
            <div class="w-40 h-40 md:w-52 md:h-52 mb-6 rounded-full p-1 border border-pink-500/30 bg-pink-500/10 memory-photo">
                <img src="New folder (3)/mylove1.jpg" class="w-full h-full object-cover rounded-full">
            </div>
            <h2 class="text-3xl md:text-5xl text-pink-100 mb-6 italic breathe-text">The Day The World Changed</h2>
            <div class="emotional-text text-center space-y-4 max-w-lg text-sm md:text-base">
                <p>Before you, I didn't realize how loud the world was. Then you walked in...</p>
                <p class="text-pink-300 italic">And everything became a melody.</p>
            </div>
            <button onclick="nextChapter()" class="soul-btn">Step Into Our Story</button>
        </div>

        <!-- CHAP 2: The Timeline -->
        <div id="chap-2" class="chapter-container">
            <h2 class="text-3xl text-pink-200 mb-6 font-serif">How Stars Aligned</h2>
            <div class="relative h-[60vh] w-full max-w-md overflow-y-auto custom-scroll flex flex-col items-center pt-10 pb-20 pointer-events-auto">
                <div class="timeline-line"></div>
                
                <div class="timeline-node relative z-10 text-center">
                    <p class="text-xs text-pink-400 uppercase tracking-widest mb-1">The Beginning</p>
                    <p class="text-white text-sm">The moment strangers became something more.</p>
                </div>

                <div class="timeline-node relative z-10 text-center">
                    <p class="text-xs text-pink-400 uppercase tracking-widest mb-1">24 May</p>
                    <p class="text-white text-sm italic">"The day you entered my world and stayed."</p>
                    <p class="text-xs text-gray-400 mt-2">I didn't know this date would mean everything.</p>
                </div>

                <div class="timeline-node relative z-10 text-center">
                    <p class="text-xs text-pink-400 uppercase tracking-widest mb-1">First Real Talk</p>
                    <p class="text-white text-sm">When I realized your voice is my favorite sound.</p>
                </div>

                <div class="timeline-node relative z-10 text-center">
                    <p class="text-xs text-pink-400 uppercase tracking-widest mb-1">Today</p>
                    <p class="text-white text-sm">Celebrating the existence of You.</p>
                </div>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-4">Continue</button>
        </div>

        <!-- CHAP 3: Gallery -->
        <div id="chap-3" class="chapter-container">
            <h2 class="text-3xl text-pink-200 mb-2 font-serif">Moments I Replay</h2>
            <div id="gallery-stage"></div> <!-- JS populates this -->
            <p id="gallery-caption" class="breathe-text px-4 text-center min-h-[50px]"></p>
            <button id="gallery-btn" onclick="revealNextMemory()" class="soul-btn mt-2">See My World</button>
        </div>

        <!-- CHAP 4: Hidden Letters -->
        <div id="chap-4" class="chapter-container">
            <h2 class="text-3xl text-white mb-6 font-serif">Things I Never Told You</h2>
            <p class="text-xs text-gray-400 mb-6 uppercase tracking-widest">Tap the notes to read my mind</p>
            
            <div class="secret-grid">
                <div class="secret-note" onclick="revealSecret(this)">
                    <div class="secret-blur text-center w-full">
                        <p class="text-pink-200 font-serif italic text-lg leading-tight">"When you are sad, my heart breaks too."</p>
                    </div>
                    <span class="note-hint">Read</span>
                </div>
                <div class="secret-note" onclick="revealSecret(this)">
                    <div class="secret-blur text-center w-full">
                        <p class="text-pink-200 font-serif italic text-lg leading-tight">"I fall for you a little more every time you say 'Sunu'."</p>
                    </div>
                    <span class="note-hint">Read</span>
                </div>
                <div class="secret-note" onclick="revealSecret(this)">
                    <div class="secret-blur text-center w-full">
                        <p class="text-pink-200 font-serif italic text-lg leading-tight">"Even your anger is cute to me."</p>
                    </div>
                    <span class="note-hint">Read</span>
                </div>
                <div class="secret-note" onclick="revealSecret(this)">
                    <div class="secret-blur text-center w-full">
                        <p class="text-pink-200 font-serif italic text-lg leading-tight">"I want to grow old with you."</p>
                    </div>
                    <span class="note-hint">Read</span>
                </div>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-8">Go Deeper</button>
        </div>

        <!-- CHAP 5: Infinite Reasons -->
        <div id="chap-5" class="chapter-container">
            <h2 class="text-2xl md:text-4xl text-pink-100 mb-2">Why I Can't Stop Loving You</h2>
            <div class="h-[40vh] w-full overflow-hidden relative flex flex-col items-center justify-center mask-image-gradient">
                <div class="text-center space-y-4 animate-scroll-up opacity-80">
                    <p class="text-lg text-gray-300">Your Kindness</p>
                    <p class="text-xl text-pink-300 font-serif italic">Your Laugh</p>
                    <p class="text-lg text-gray-300">The way you look at me</p>
                    <p class="text-xl text-pink-300 font-serif italic">Your Voice at 11 PM</p>
                    <p class="text-lg text-gray-300">Your Care</p>
                    <p class="text-xl text-pink-300 font-serif italic">The way you say my name</p>
                    <p class="text-lg text-gray-300">Your beautiful Soul</p>
                    <p class="text-xl text-pink-300 font-serif italic">Just being You</p>
                </div>
            </div>
            <button onclick="nextChapter()" class="soul-btn">My Heart</button>
        </div>

        <!-- CHAP 6: Interactive Heart -->
        <div id="chap-6" class="chapter-container">
            <h2 class="text-2xl text-gray-400 mb-8 font-light">If you could hear it beat...</h2>
            <div id="interactive-heart" class="heartbeat-glow" onclick="touchHeart()">
                ‚ù§Ô∏è
            </div>
            <p id="heart-text" class="heart-message">It beats only for you.</p>
            <p id="heart-sub" class="heart-message text-sm text-white mt-1">Please handle it with care.</p>
            
            <button id="heart-next-btn" onclick="nextChapter()" class="soul-btn mt-8 opacity-0 pointer-events-none transition-opacity">Open Letter</button>
        </div>

        <!-- CHAP 7: Love Letter (FIXED) -->
        <div id="chap-7" class="chapter-container">
            <!-- Envelope -->
            <div id="letter-closed" class="flex flex-col items-center justify-center envelope-container" onclick="openLetter()">
                <div class="relative">
                    <div class="w-64 h-40 bg-pink-900/40 border border-pink-500/30 rounded-lg flex items-center justify-center backdrop-blur-md shadow-2xl">
                        <div class="wax-seal"><span class="heartbeat-glow">‚ù§</span></div>
                    </div>
                    <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 text-pink-200 handwritten text-2xl w-full text-center">For Nayanika</div>
                </div>
                <p class="text-xs text-gray-400 mt-8 uppercase tracking-widest animate-pulse">Tap to Open</p>
            </div>

            <!-- The Letter Content (Initially Hidden) -->
            <div id="letter-content" class="letter-paper custom-scroll">
                <p class="text-lg font-serif italic leading-relaxed">
                    My Dearest Nayanika, <br><br>
                    I wanted to write this because sometimes saying it out loud isn't enough. <br><br>
                    "Nayanika" isn't just a name to me anymore. It means <b>Home</b>. It means <b>Peace</b>. <br><br>
                    Thank you for being my light in the dark. Thank you for the 24th of May. Thank you for choosing me every single day.<br><br>
                    I promise to be the man who makes you smile even on your worst days. I promise to listen when the world is too loud. <br><br>
                    I love you more than this website can ever say.<br><br>
                    Forever yours,<br>
                    <b>YOUR RUDRA (SUNNY)</b>
                </p>
                <div class="w-full flex justify-center mt-8 pb-4">
                    <button onclick="nextChapter()" class="text-pink-900 border border-pink-900 px-6 py-2 rounded-full uppercase text-xs tracking-widest hover:bg-pink-900 hover:text-white transition font-bold">
                        My Vow
                    </button>
                </div>
            </div>
        </div>

        <!-- CHAP 8: Future Promise -->
        <div id="chap-8" class="chapter-container">
            <div class="max-w-xl text-center px-4">
                <h1 class="text-3xl md:text-5xl text-white mb-6 leading-tight breathe-text">"A Future With You."</h1>
                <div class="space-y-4 text-gray-300 font-light text-sm md:text-base">
                    <p>I see us growing up.</p>
                    <p>I see us growing old.</p>
                    <p>I see me holding your hand through every season.</p>
                </div>
                <p class="text-pink-200 italic font-serif mt-8 text-xl">"In every lifetime, I will find you."</p>
            </div>
            <button onclick="nextChapter()" class="soul-btn mt-8">Make a Wish</button>
        </div>

        <!-- CHAP 9: Cake -->
        <div id="chap-9" class="chapter-container">
            <h2 class="text-3xl text-white mb-2 handwritten">Happy Birthday, Sunu</h2>
            <p id="cake-instruction" class="text-xs tracking-widest text-pink-400 uppercase mb-8 animate-pulse">Tap the candles to make a wish</p>
            
            <div id="cake-section" class="flex flex-col items-center relative">
                <div class="candles-container">
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="candle" onclick="blowCandle(this)"><div class="flame"></div></div>
                </div>
                <div class="cake-body" onclick="cutCake()">
                    <div class="icing"></div>
                    <span class="text-pink-900/20 text-4xl font-bold select-none z-10">üéÇ</span>
                </div>
                <div class="w-48 h-2 bg-white/10 rounded-full mt-2 blur-sm"></div>
            </div>
        </div>

        <!-- CHAP 10: Finale -->
        <div id="chap-10" class="chapter-container">
            <div class="relative group cursor-pointer perspective-1000 mb-6">
                <div class="absolute -inset-4 bg-pink-600/30 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition duration-1000"></div>
                <img src="New folder (3)/surprise.jpg" id="final-img" class="relative w-64 md:w-80 rounded-lg border-2 border-white/20 shadow-2xl transform scale-95 opacity-0">
            </div>
            <div class="h-24 w-full flex items-center justify-center px-4">
                <h1 id="typewriter" class="text-xl md:text-3xl text-pink-200 font-serif italic text-center leading-relaxed heartbeat-glow"></h1>
            </div>
            <p class="text-gray-600 text-xs mt-8">If this website could hug you...<br>it would hold you forever.</p>
        </div>

    </div>

    <!-- Music Control -->
    <div onclick="toggleMusic()" class="fixed bottom-6 right-6 text-white/50 hover:text-white cursor-pointer z-50 transition duration-300 p-2 bg-black/20 rounded-full backdrop-blur-sm border border-white/10">
        <span id="music-status">üîá Play Music</span>
    </div>

    <script>
        // --- 1. SETUP & UTILS ---
        // Register GSAP Plugin
        gsap.registerPlugin(TextPlugin);

        const cursorDot = document.getElementById("cursor-dot");
        document.addEventListener("mousemove", (e) => {
            cursorDot.style.left = e.clientX + "px"; cursorDot.style.top = e.clientY + "px";
            if(Math.random() > 0.9) createSparkle(e.clientX, e.clientY);
        });
        function createSparkle(x, y) {
            const s = document.createElement("div"); s.classList.add("sparkle"); document.body.appendChild(s);
            const size = Math.random() * 4 + 2; s.style.width = `${size}px`; s.style.height = `${size}px`;
            s.style.left = `${x}px`; s.style.top = `${y}px`;
            setTimeout(() => { s.remove(); }, 1000);
        }

        // --- 2. FLOATING WORDS EFFECT ---
        const loveWords = ["Sunu", "Love", "Forever", "24 May", "Nayanika", "Peace", "Home", "Mine", "Heart"];
        function spawnFloatingWord() {
            const container = document.getElementById('floating-words-container');
            const word = document.createElement('div');
            word.innerText = loveWords[Math.floor(Math.random() * loveWords.length)];
            word.className = "floating-word";
            word.style.left = Math.random() * 90 + 5 + "vw";
            word.style.fontSize = (Math.random() * 1 + 1) + "rem";
            word.style.animationDuration = (Math.random() * 10 + 10) + "s";
            container.appendChild(word);
            setTimeout(() => { word.remove(); }, 20000);
        }
        setInterval(spawnFloatingWord, 2000);

        // --- 3. GALLERY DATA ---
        const memories = [
            { src: "New folder (3)/mylove1.jpg", text: "Your smile makes my winter warm.", btn: "See My Soul" },
            { src: "New folder (3)/mylove2.jpg", text: "Eyes that hold my entire universe.", btn: "See My Heart" },
            { src: "New folder (3)/mylove3.jpg", text: "I want to live in this moment forever.", btn: "See My Breath" },
            { src: "New folder (3)/mylove4.jpg", text: "Elegance isn't what you wear, it's you.", btn: "See My Peace" },
            { src: "New folder (3)/sur1.jpg", text: "Even in chaos, you are my calm.", btn: "See My Joy" },
            { src: "New folder (3)/sur2.jpg", text: "Your laugh heals my broken parts.", btn: "See My Life" },
            { src: "New folder (3)/sur3.jpg", text: "My favorite view in the world.", btn: "See My Forever" },
            { src: "New folder (3)/sur4.jpg", text: "Us. My favorite story.", btn: "Go Deeper" }
        ];
        let memoryIndex = 0;

        function revealNextMemory() {
            if (memoryIndex >= memories.length) { nextChapter(); return; }
            const stage = document.getElementById("gallery-stage");
            const data = memories[memoryIndex];

            // Move old photos
            stage.querySelectorAll(".polaroid.active").forEach(p => {
                p.classList.remove("active"); p.classList.add("bg");
                const rot = (Math.random() - 0.5) * 40;
                const x = (Math.random() - 0.5) * 300;
                gsap.to(p, { x: x, rotation: rot, scale: 0.8, duration: 1 });
            });

            // New photo
            const div = document.createElement("div"); div.className = "polaroid active";
            gsap.set(div, { y: 100, opacity: 0, scale: 0.5 });
            const img = document.createElement("img"); img.src = data.src;
            div.appendChild(img); stage.appendChild(div);
            gsap.to(div, { y: 0, opacity: 1, scale: 1.2, duration: 1, ease: "back.out(1.2)" });

            // Text
            const caption = document.getElementById("gallery-caption");
            const btn = document.getElementById("gallery-btn");
            gsap.to(caption, { opacity: 0, duration: 0.2, onComplete: () => {
                caption.innerText = `"${data.text}"`;
                gsap.to(caption, { opacity: 1, duration: 0.5 });
            }});
            btn.innerText = data.btn;
            memoryIndex++;
        }

        // --- 4. NAVIGATION LOGIC ---
        window.onload = () => {
            gsap.to("#loader", { opacity: 0, duration: 1.5, onComplete: () => {
                document.getElementById("loader").style.display = "none";
                document.getElementById("intro-screen").classList.remove("hidden");
                initParticles();
            }});
        };

        const audio = document.getElementById('bg-music');
        let musicPlaying = false;
        function toggleMusic() {
            const status = document.getElementById("music-status");
            if(musicPlaying) { audio.pause(); status.innerText = "üîá Play Music"; } 
            else { audio.play().then(() => { status.innerText = "üîä Pause"; }).catch(e => { alert("Interact to play"); }); }
            musicPlaying = !musicPlaying;
        }

        let currentChap = 1;
        const totalChap = 10; 

        function startJourney() {
            gsap.to("#intro-screen", { opacity: 0, duration: 2, onComplete: () => {
                document.getElementById("intro-screen").style.display = "none";
                document.getElementById("main-stage").classList.remove("hidden");
                gsap.to("#main-stage", { opacity: 1, duration: 2 });
                audio.volume = 0.5; audio.play().catch(()=>{});
                musicPlaying = true; document.getElementById("music-status").innerText = "üîä Pause";
                animateElements(1);
            }});
        }

        function nextChapter() {
            const curr = document.getElementById(`chap-${currentChap}`);
            const next = document.getElementById(`chap-${currentChap+1}`);
            
            // Immediately disable clicks on old chapter to prevent overlap issues
            if(curr) curr.style.pointerEvents = "none";

            gsap.to("#progress", { width: `${(currentChap/totalChap)*100}%`, duration: 1 });
            gsap.to(curr, { opacity: 0, y: -20, duration: 0.8, ease: "power2.in", onComplete: () => {
                curr.classList.remove("chapter-active");
                if(next) {
                    next.classList.add("chapter-active");
                    // Enable clicks on new chapter
                    next.style.pointerEvents = "auto"; 
                    gsap.fromTo(next, { opacity: 0, y: 30 }, { opacity: 1, y: 0, duration: 1, ease: "power2.out" });
                    currentChap++;
                    animateElements(currentChap);
                    if(currentChap === 3 && memoryIndex === 0) revealNextMemory(); 
                }
            }});
        }

        function animateElements(id) {
            gsap.fromTo(`#chap-${id} p, #chap-${id} h2, #chap-${id} h1`, { opacity: 0, y: 15 }, { opacity: 1, y: 0, duration: 1.5, stagger: 0.2, ease: "power3.out" });
            gsap.fromTo(`#chap-${id} .soul-btn`, { opacity: 0, scale: 0.9 }, { opacity: 1, scale: 1, duration: 1, delay: 1.5 });
            
            if(id === 2) {
                gsap.fromTo(".timeline-node", {opacity: 0, x: -20}, {opacity: 1, x: 0, duration: 0.8, stagger: 0.5, delay: 0.5});
            }
        }

        // --- 5. INTERACTION FUNCTIONS ---
        function revealSecret(el) {
            el.classList.add("secret-revealed");
            el.querySelector(".note-hint").style.display = "none";
        }

        function touchHeart() {
            const heart = document.getElementById("interactive-heart");
            const msg1 = document.getElementById("heart-text");
            const msg2 = document.getElementById("heart-sub");
            const btn = document.getElementById("heart-next-btn");

            heart.style.transform = "scale(1.2)";
            setTimeout(() => heart.style.transform = "scale(1)", 200);
            
            msg1.style.opacity = 1; msg1.style.transform = "translateY(0)";
            setTimeout(() => {
                msg2.style.opacity = 1; msg2.style.transform = "translateY(0)";
                btn.style.opacity = 1; btn.style.pointerEvents = "all";
            }, 1000);
        }

        // --- FIXED LETTER OPENING LOGIC ---
        function openLetter() {
            const envelope = document.getElementById("letter-closed");
            const content = document.getElementById("letter-content");
            
            // Force hide envelope if animation glitches
            gsap.to(envelope, { scale: 0, opacity: 0, duration: 0.5, onComplete: () => {
                envelope.style.display = "none";
                content.style.display = "flex";
                gsap.fromTo(content, { scale: 0.5, opacity: 0, rotationX: 90 }, { scale: 1, opacity: 1, rotationX: 0, duration: 1, ease: "back.out(1.2)" });
            }});
        }

        // --- 6. CAKE & FINALE ---
        let candlesOut = 0;
        function blowCandle(el) {
            const flame = el.querySelector('.flame');
            if(flame && !flame.classList.contains('out')) {
                flame.classList.add('out'); 
                candlesOut++;
                const puff = document.createElement("div"); puff.innerText = "üí®";
                puff.style.position = "absolute"; puff.style.top = "-40px"; puff.style.left = "0"; puff.style.color = "white"; puff.style.animation = "fadeAndScale 1s forwards";
                el.appendChild(puff);

                if(candlesOut === 3) {
                    const instr = document.getElementById("cake-instruction");
                    instr.innerText = "Now... cut the cake."; 
                    instr.classList.add("text-white");
                    gsap.to(".cake-body", { scale: 1.05, yoyo: true, repeat: -1, duration: 0.5 });
                }
            }
        }
        function cutCake() {
            if(candlesOut < 3) return;
            gsap.killTweensOf(".cake-body");
            gsap.to("#chap-9", { opacity: 0, scale: 0.9, duration: 1, onComplete: () => {
                document.getElementById("chap-9").classList.remove("chapter-active");
                document.getElementById("chap-10").classList.add("chapter-active");
                revealFinale();
            }});
        }

        function revealFinale() {
            const end = Date.now() + 5000;
            const colors = ['#fbcfe8', '#f472b6', '#db2777'];
            (function frame() {
                confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: colors, shapes: ['circle'], scalar: 1.2, drift: 0.5 });
                confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: colors, shapes: ['circle'], scalar: 1.2, drift: -0.5 });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());

            gsap.fromTo("#final-img", { scale: 0.8, opacity: 0 }, { scale: 1, opacity: 1, duration: 2, ease: "power3.out" });
            
            // This requires the TextPlugin registered above
            gsap.to("#typewriter", { text: "Happy Birthday, sunu. You are my answered prayer. ‚ù§Ô∏è", duration: 4, delay: 1, ease: "none" });
            
            if(musicPlaying) gsap.to(audio, { volume: 0.8, duration: 4 });
        }

        // --- 7. BACKGROUND PARTICLES ---
        function initParticles() {
            const canvas = document.getElementById('bg-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            const geometry = new THREE.BufferGeometry();
            const count = 400; const pos = new Float32Array(count*3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*15;
            geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const material = new THREE.PointsMaterial({ size: 0.02, color: 0xffafcc, transparent: true, opacity: 0.5 });
            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                particles.rotation.y += 0.0003; particles.position.y += Math.sin(Date.now()*0.001)*0.001;
                renderer.render(scene, camera);
            }
            animate();
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
</body>
</html>
