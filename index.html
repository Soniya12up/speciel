<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nayanika | The Muse</title>
    
    <!-- Cinematic Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Great+Vibes&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'royal': ['Cinzel', 'serif'],
                        'script': ['Great Vibes', 'cursive'],
                        'body': ['Lato', 'sans-serif'],
                    },
                    colors: {
                        'deep-void': '#050203',
                        'rose-gold': '#e11d48',
                        'pale-gold': '#fce7f3'
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CORE AESTHETICS --- */
        body {
            margin: 0; overflow: hidden; background-color: #050203; 
            font-family: 'Lato', sans-serif; color: #fce7f3;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* Cinematic Overlays */
        .vignette {
            position: fixed; inset: 0; pointer-events: none; z-index: 2;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 100%);
        }
        .noise {
            position: fixed; inset: 0; pointer-events: none; z-index: 3;
            opacity: 0.04; background-image: url("https://grainy-gradients.vercel.app/noise.svg");
            filter: contrast(150%) brightness(100%);
        }

        /* Glassmorphism Panels */
        .glass-panel {
            width: 100%; height: 100vh; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .chapter-container {
            position: absolute; inset: 0; padding: 1.5rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; text-align: center; z-index: 10;
            pointer-events: none; /* Fix: prevents clicking through hidden chapters */
        }
        .chapter-active { opacity: 1; visibility: visible; z-index: 20; pointer-events: auto; }

        /* UI Components */
        .majestic-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.3);
            color: white; padding: 14px 30px; 
            font-family: 'Cinzel', serif; font-size: 0.8rem; letter-spacing: 3px;
            text-transform: uppercase; transition: all 0.6s ease;
            margin-top: 30px; cursor: pointer; position: relative; overflow: hidden; 
            pointer-events: auto; z-index: 50; border-radius: 4px;
        }
        .majestic-btn:hover { background: rgba(225, 29, 72, 0.1); border-color: #fda4af; box-shadow: 0 0 40px rgba(225, 29, 72, 0.3); }

        .gold-text {
            background: linear-gradient(to bottom, #fff 0%, #fbcfe8 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255,192,203,0.3);
        }
        .breathe { animation: breathe 6s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { opacity: 0.7; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } }

        /* --- EMOTIONAL SECTIONS CSS --- */
        
        /* Smile Sensor */
        .smile-sensor {
            width: 100px; height: 100px; border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; cursor: pointer; transition: all 0.5s;
            animation: pulse-border 2s infinite;
        }
        .smile-sensor:hover, .smile-sensor:active {
            background: rgba(225, 29, 72, 0.2);
            box-shadow: 0 0 50px #e11d48; border-color: #e11d48;
            transform: scale(1.1);
        }
        @keyframes pulse-border { 0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.2); } 70% { box-shadow: 0 0 0 20px rgba(255,255,255,0); } 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); } }

        /* Healing Heart */
        .heart-container { cursor: pointer; transition: transform 0.3s; width: 150px; height: 150px; }
        .heart-path { transition: all 1s ease; fill: #330510; stroke: #e11d48; stroke-width: 2; }
        .healed .heart-path { fill: #e11d48; stroke: #fff; filter: drop-shadow(0 0 20px #e11d48); }
        .crack { transition: all 1s ease; stroke: #fff; stroke-width: 3; opacity: 0.8; }
        .healed .crack { opacity: 0; stroke-width: 0; }

        /* Confession Cards */
        .confession-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 500px; width: 100%; pointer-events: auto; }
        .confession-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            padding: 20px; min-height: 100px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; position: relative; overflow: hidden; border-radius: 8px; text-align: center;
        }
        .confession-blur {
            position: absolute; inset: 0; background: rgba(5, 2, 3, 0.9);
            backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center;
            transition: opacity 0.5s;
        }
        .confession-card.revealed .confession-blur { opacity: 0; pointer-events: none; }

        /* Hand Drag */
        .hand { font-size: 5rem; position: absolute; filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); user-select: none; }
        #my-hand { bottom: 20%; right: 20%; opacity: 0.5; }
        #her-hand { top: 20%; left: 20%; cursor: grab; z-index: 50; }
        #her-hand:active { cursor: grabbing; transform: scale(1.1); }

        /* Love Petals */
        .petal-text {
            position: absolute; pointer-events: none; font-family: 'Great Vibes', cursive;
            color: #fda4af; font-size: 1.5rem; text-shadow: 0 0 10px rgba(0,0,0,0.8);
            animation: floatUpFade 3s forwards; z-index: 999;
        }
        @keyframes floatUpFade { 0%{opacity:1; transform:translateY(0);} 100%{opacity:0; transform:translateY(-150px);} }

        /* Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #be123c; border-radius: 10px; }
        
        .polaroid {
            background: #fff; padding: 10px 10px 25px 10px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        /* Puzzle */
        #puzzle-wrapper {
            position: relative; width: 80vw; max-width: 300px; aspect-ratio: 3/4; margin: 0 auto;
        }
        #puzzle-container {
            width: 100%; height: 100%; position: relative;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        }
        .puzzle-piece {
            position: absolute; background-image: url('New folder (3)/mylove1.jpg'); 
            background-repeat: no-repeat; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 0 10px rgba(225, 29, 72, 0.5);
            pointer-events: auto; z-index: 100;
        }
        .piece-solved { border: none; box-shadow: none; pointer-events: none; z-index: 1; }

        /* Cake */
        .cake-container { position: relative; cursor: pointer; transform: scale(1.2); pointer-events: auto; margin-top: 50px; }
        .flame {
            width: 12px; height: 20px; background: #fbbf24; border-radius: 50% 50% 20% 20%;
            position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
            box-shadow: 0 0 20px #f59e0b, 0 0 40px #b45309;
            animation: flicker 0.8s infinite alternate;
        }
        .flame.out { animation: none; opacity: 0; transform: translateX(-50%) scale(0); transition: 0.5s; }
        @keyframes flicker { 0% { opacity: 1; transform: translateX(-50%) scale(1); } 100% { opacity: 0.8; transform: translateX(-50%) scale(1.1); } }

    </style>
</head>
<body onclick="createPetal(event)">

    <!-- Visual Layers -->
    <div class="noise"></div>
    <div class="vignette"></div>

    <!-- Audio -->
    <audio id="bg-music" loop preload="auto"><source src="songs1/love12.mp3" type="audio/mpeg"></audio>
    <canvas id="bg-canvas" style="position: fixed; top:0; left:0; z-index:-1;"></canvas>

    <!-- Loader -->
    <div id="loader" class="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center">
        <div class="w-px h-24 bg-gradient-to-b from-transparent via-pink-500 to-transparent animate-pulse mb-8"></div>
        <p class="text-white font-royal tracking-[0.5em] text-xs uppercase opacity-80">Calibrating Universe...</p>
    </div>

    <!-- Intro -->
    <div id="intro-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-1000 hidden">
        <p class="text-pink-300 font-script text-4xl mb-6 opacity-80 breathe">My Dearest Soul,</p>
        <h1 class="text-6xl md:text-9xl font-royal gold-text mb-8 tracking-tighter mix-blend-screen text-center">NAYANIKA</h1>
        <p class="text-white/40 font-body text-[10px] uppercase tracking-[0.4em] mb-16">Tap to Enter</p>
        <button onclick="startJourney()" class="majestic-btn">Begin Journey</button>
    </div>

    <!-- Main Stage -->
    <div id="main-stage" class="glass-panel opacity-0 transition-opacity duration-1000 hidden">

        <!-- Progress Bar -->
        <div class="absolute top-0 left-0 w-full h-[2px] bg-white/5 z-30">
            <div id="progress" class="h-full bg-rose-600 w-0 shadow-[0_0_20px_#e11d48] transition-all duration-1000"></div>
        </div>

        
       <!-- NEW 1: SMILE SENSOR (FIXED) -->
<div id="chap-1" class="chapter-container chapter-active">
    <h2 class="text-3xl font-royal text-white mb-8">First, a check...</h2>
    <!-- Added explicit z-index to ensure it captures hover/clicks -->
    <div class="smile-sensor relative z-50" onmouseover="activateSmile()" onclick="activateSmile()">
        üòä
    </div>
    <p id="smile-msg" class="text-pink-300 font-script text-2xl mt-8 opacity-0 transition duration-1000">"When you smile, my whole world becomes lighter."</p>
    
    <!-- FIXED BUTTON: Removed 'pointer-events-none' class and handled it via inline style for better control -->
    <button id="smile-btn" onclick="nextChapter()" class="majestic-btn opacity-0" style="pointer-events: none; margin-top: 30px;">Enter</button>
</div>

        <!-- 2: THE REVELATION -->
        <div id="chap-2" class="chapter-container">
            <div class="relative w-56 h-56 md:w-80 md:h-80 mb-10 rounded-full border border-white/10 p-2 flex items-center justify-center">
                <div class="absolute inset-0 rounded-full border border-pink-500/20 animate-[spin_10s_linear_infinite]"></div>
                <div class="w-full h-full rounded-full overflow-hidden relative group">
                    <img src="New folder (3)/mylove1.jpg" onerror="this.src='https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=1000&auto=format&fit=crop'" class="w-full h-full object-cover opacity-90 transition duration-700 group-hover:scale-110 group-hover:opacity-100">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                </div>
            </div>
            <h2 class="text-3xl md:text-6xl font-royal text-white mb-6 leading-tight">The Center of<br><span class="text-pink-400 italic font-script pr-2">My Universe</span></h2>
            <div class="text-center space-y-4 max-w-lg font-body font-light text-white/70 px-4">
                <p>Before you, time was just a concept.</p>
                <p>Now, every second without you feels like a wasted eternity.</p>
            </div>
            <button onclick="nextChapter()" class="majestic-btn">Our Timeline</button>
        </div>

        <!-- 3: THE TIMELINE -->
        <div id="chap-3" class="chapter-container">
            <h2 class="text-3xl md:text-4xl font-royal text-pink-100 mb-12 border-b border-white/10 pb-4">Written In The Stars</h2>
            
            <div class="relative w-full max-w-md h-[50vh] overflow-y-auto custom-scroll px-4 pointer-events-auto">
                <div class="absolute left-[20px] top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-pink-700 to-transparent"></div>
                
                <div class="ml-10 mb-10 relative group text-left">
                    <div class="absolute -left-[45px] top-2 w-3 h-3 bg-pink-500 rounded-full shadow-[0_0_10px_#ec4899]"></div>
                    <span class="text-xs font-royal text-pink-400 tracking-widest">24 JANUARY 2008</span>
                    <h3 class="text-xl text-white mt-1 font-royal">A Star Was Born</h3>
                    <p class="text-sm text-gray-400 mt-2 font-body font-light">The day the world became a little brighter. My destiny began here, even if I didn't know it yet.</p>
                </div>

                <div class="ml-10 mb-10 relative group text-left">
                    <div class="absolute -left-[45px] top-2 w-3 h-3 bg-white border border-pink-500 rounded-full"></div>
                    <span class="text-xs font-royal text-pink-400 tracking-widest">24 MAY</span>
                    <h3 class="text-xl text-white mt-1 font-royal">"The Day You Stayed"</h3>
                    <p class="text-sm text-gray-400 mt-2 font-body font-light">Two souls, wandering the same earth, finally found their home in each other.</p>
                </div>

                <div class="ml-10 relative group text-left">
                    <div class="absolute -left-[45px] top-2 w-3 h-3 bg-white border border-pink-500 rounded-full"></div>
                    <span class="text-xs font-royal text-pink-400 tracking-widest">TODAY</span>
                    <h3 class="text-xl text-white mt-1 font-royal">Celebrating Nayanika</h3>
                    <p class="text-sm text-gray-400 mt-2 font-body font-light">Celebrating 17 years of your existence, and every moment I get to call you mine.</p>
                </div>
            </div>
            <button onclick="nextChapter()" class="majestic-btn">Healing</button>
        </div>

        <!-- NEW 4: HEALING HEART -->
        <div id="chap-4" class="chapter-container">
            <h2 class="text-3xl font-royal text-white mb-2">You Healed Me</h2>
            <p class="text-xs tracking-widest text-white/50 mb-10 uppercase">Tap the broken heart to make it whole</p>
            
            <div class="heart-container" onclick="healHeart(this)">
                <svg viewBox="0 0 100 100" class="w-full h-full overflow-visible">
                    <path class="heart-path" d="M50 88.9L16.7 55.6C7.2 46.1 7.2 30.9 16.7 21.4s24.8-9.5 33.3 0L50 21.4l0 0 0 0L83.3 21.4c8.5-9.5 23.8-9.5 33.3 0s9.5 24.7 0 34.2L50 88.9z"/>
                    <path class="crack" d="M50 25 L40 40 L60 55 L45 70 L50 85" fill="none" />
                </svg>
            </div>

            <p id="heal-msg" class="text-rose-300 font-script text-3xl mt-8 opacity-0 transition">"You make everything in me whole."</p>
            <button id="heal-btn" onclick="nextChapter()" class="majestic-btn opacity-0 pointer-events-none">Connection</button>
        </div>

        <!-- NEW 5: HAND DRAG -->
        <div id="chap-5" class="chapter-container">
            <h2 class="text-3xl font-royal text-white mb-2">Connection</h2>
            <p class="text-xs tracking-widest text-white/50 mb-20 uppercase">Drag the hand to hold mine</p>
            
            <div class="relative w-full h-[50vh] max-w-md bg-white/5 rounded-lg border border-white/10" id="drag-zone">
                <div id="my-hand" class="hand">ü´¥</div>
                <div id="her-hand" class="hand">ü§ö</div>
            </div>

            <p id="hand-msg" class="text-white font-body mt-6 opacity-0">This is how I want to hold you forever.</p>
            <button id="hand-btn" onclick="nextChapter()" class="majestic-btn opacity-0 pointer-events-none">Memories</button>
        </div>

        <!-- 6: GALLERY (Modified with Emotional Text) -->
        <div id="chap-6" class="chapter-container">
            <h2 class="text-3xl font-royal text-white mb-2">Fragments of Beauty</h2>
            <p class="font-script text-pink-300 text-2xl mb-8">"You are art I never tire of admiring"</p>
            
            <div id="gallery-stage" class="relative w-full h-[45vh] flex justify-center items-center perspective-[1000px]"></div>
            
            <div class="h-24 flex items-center justify-center mt-4 px-4">
                <p id="gallery-caption" class="text-white/80 font-body font-light italic tracking-wide text-center text-lg"></p>
            </div>
            <button id="gallery-btn" onclick="revealNextMemory()" class="majestic-btn">Reveal Next</button>
        </div>

        <!-- NEW 7: CONFESSIONS & NUMBERS -->
        <div id="chap-7" class="chapter-container">
            <h2 class="text-3xl font-royal text-white mb-6">Things I Never Say...</h2>
            
            <div class="grid grid-cols-2 gap-8 mb-8 w-full max-w-lg">
                <div class="text-center">
                    <h3 class="text-4xl font-royal gold-text" id="days-count">0</h3>
                    <p class="text-[10px] uppercase tracking-widest text-white/50">Days Since May 24</p>
                </div>
                <div class="text-center">
                    <h3 class="text-4xl font-royal gold-text">Infinite</h3>
                    <p class="text-[10px] uppercase tracking-widest text-white/50">Moments Loved</p>
                </div>
            </div>

            <div class="confession-grid pointer-events-auto">
                <div class="confession-card" onclick="revealConfession(this)">
                    <p class="text-sm font-body text-pink-100">I love how you get jealous.</p>
                    <div class="confession-blur"><span class="text-2xl">üîí</span></div>
                </div>
                <div class="confession-card" onclick="revealConfession(this)">
                    <p class="text-sm font-body text-pink-100">I love how you call me without thinking.</p>
                    <div class="confession-blur"><span class="text-2xl">üîí</span></div>
                </div>
                <div class="confession-card" onclick="revealConfession(this)">
                    <p class="text-sm font-body text-pink-100">I love how you worry about me.</p>
                    <div class="confession-blur"><span class="text-2xl">üîí</span></div>
                </div>
                <div class="confession-card" onclick="revealConfession(this)">
                    <p class="text-sm font-body text-pink-100">I love how you fight for us.</p>
                    <div class="confession-blur"><span class="text-2xl">üîí</span></div>
                </div>
            </div>
            <button onclick="nextChapter()" class="majestic-btn">Close To You</button>
        </div>

        <!-- NEW 8: THE HUG & CAROUSEL -->
        <div id="chap-8" class="chapter-container">
            <div class="max-w-xl text-center px-6 mb-10">
                <h2 class="text-2xl md:text-4xl font-body font-light text-white leading-relaxed opacity-0" id="hug-text">
                    "If I could hug you right now...<br>I wouldn't let go for a very long time."
                </h2>
            </div>
            <div class="h-20 flex items-center justify-center">
                <h2 id="word-carousel" class="text-3xl md:text-5xl font-script text-pink-300">Peace</h2>
            </div>
            <p class="text-white/60 text-sm mt-4">All these words feel like you.</p>
            <button onclick="nextChapter()" class="majestic-btn mt-8">Piece by Piece</button>
        </div>

        <!-- 9: THE PUZZLE -->
        <div id="chap-9" class="chapter-container">
            <h2 class="text-2xl md:text-3xl font-royal text-white mb-2">Piece by Piece...</h2>
            <p id="puzzle-instruction" class="text-[10px] md:text-xs text-rose-300 tracking-[0.2em] uppercase mb-6 animate-pulse">Tap the floating shards</p>
            <div id="puzzle-wrapper">
                <div id="puzzle-container"></div>
            </div>
            <p id="puzzle-msg" class="h-8 mt-4 font-script text-xl md:text-2xl text-pink-200 transition-opacity duration-500 opacity-0 px-2"></p>
            <button id="game-next-btn" onclick="nextChapter()" class="majestic-btn opacity-0 pointer-events-none mt-2">Open Letter</button>
        </div>

        <!-- 10: LETTER & PROMISES -->
        <div id="chap-10" class="chapter-container">
            <div id="letter-closed" class="cursor-pointer group perspective-[1000px]" onclick="openLetter()">
                <div class="w-72 h-48 md:w-80 md:h-52 bg-[#1a050a] border border-[#e11d48] rounded-md shadow-[0_0_30px_rgba(225,29,72,0.2)] flex items-center justify-center relative transition transform group-hover:rotate-x-12">
                    <div class="absolute w-12 h-12 bg-rose-700 rounded-full flex items-center justify-center shadow-lg border border-white/20 text-xl">‚ù¶</div>
                    <p class="absolute bottom-6 font-royal text-[10px] tracking-[0.4em] text-rose-300">CLICK TO OPEN</p>
                </div>
            </div>

            <div id="letter-content" class="hidden flex-col bg-[#fff1f2] text-rose-950 w-full max-w-lg h-[60vh] p-6 md:p-8 rounded-sm shadow-2xl overflow-y-auto custom-scroll text-left relative pointer-events-auto">
                <p class="font-royal text-xs tracking-widest text-center mb-6 uppercase border-b border-rose-900/10 pb-4">January 24th, 2025</p>
                <p class="font-royal text-xl mb-4">My Dearest Nayanika,</p>
                <p class="font-body leading-loose text-sm md:text-base mb-4">
                    As I write this, I am thinking about the day you were born‚Äî<b>January 24, 2008</b>. The stars must have danced that day, knowing that a soul as beautiful as yours was entering the world.<br><br>
                    "Nayanika" isn't just a name. To me, it means <b>Home</b>. It means <b>Peace</b>.<br><br>
                    Thank you for the 24th of May. Thank you for choosing me every single day. Even when I am difficult, you are patient. Even when the world is loud, you are my quiet.<br><br>
                    I love you, infinitely.
                </p>
                <p class="font-script text-2xl md:text-3xl text-right mt-8 text-rose-800">Yours Forever,<br> (Your Name)</p>
                <div class="text-center mt-8">
                    <button onclick="document.getElementById('letter-content').style.display='none'; document.getElementById('promise-overlay').classList.remove('hidden'); loadPromise(0);" class="border border-rose-900 text-rose-900 px-6 py-2 text-xs font-royal uppercase hover:bg-rose-900 hover:text-white transition">My Promises</button>
                </div>
            </div>

            <!-- PROMISES OVERLAY (Inside Chap 10 for better flow) -->
            <div id="promise-overlay" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-black/90 z-50">
                <h2 class="text-2xl md:text-3xl font-royal text-pink-100 mb-6">My Sacred Vows</h2>
                <div id="promise-card" class="relative w-64 h-80 md:w-72 md:h-96 bg-black/40 border border-white/10 rounded-xl overflow-hidden flex flex-col justify-end p-6 shadow-2xl backdrop-blur-sm">
                    <img id="promise-img" src="" class="absolute inset-0 w-full h-full object-cover opacity-60 transition duration-1000">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                    <div class="relative z-10 translate-y-4 opacity-0 transition-all duration-700" id="promise-text-container">
                        <h3 id="promise-title" class="text-lg md:text-xl font-royal text-white mb-2 leading-tight"></h3>
                        <p id="promise-desc" class="text-xs font-body text-gray-300 leading-relaxed"></p>
                    </div>
                </div>
                <p id="promise-count" class="text-white/30 text-[10px] tracking-[0.3em] mt-6">1 / 18</p>
                <button id="promise-next-btn" onclick="nextPromise()" class="majestic-btn mt-4">Next Promise</button>
            </div>
        </div>

        <!-- 11: CAKE -->
        <div id="chap-11" class="chapter-container">
            <h2 class="text-4xl md:text-5xl font-royal gold-text mb-2 text-center">Happy 17th Birthday</h2>
            <p id="wish-instruction" class="text-[10px] tracking-[0.4em] text-pink-400 uppercase mb-12 animate-pulse text-center">Close your eyes & Make a wish</p>
            <div class="cake-container">
                <div class="flex gap-4 justify-center absolute -top-10 w-full z-10">
                    <div class="w-2 h-12 bg-white rounded relative cursor-pointer" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="w-2 h-12 bg-white rounded relative cursor-pointer" onclick="blowCandle(this)"><div class="flame"></div></div>
                    <div class="w-2 h-12 bg-white rounded relative cursor-pointer" onclick="blowCandle(this)"><div class="flame"></div></div>
                </div>
                <div class="w-40 h-20 md:w-48 md:h-24 bg-gradient-to-b from-rose-200 to-rose-300 rounded-t-lg relative flex items-center justify-center border-t-4 border-white shadow-2xl" onclick="checkCake()">
                    <div class="absolute top-0 left-0 w-full h-6 bg-white/50 blur-sm rounded-[50%]"></div>
                    <span class="text-4xl">üéÇ</span>
                </div>
            </div>
        </div>

        <!-- 12: FINALE -->
        <div id="chap-12" class="chapter-container">
            <div class="relative group cursor-pointer mb-8">
                <div class="absolute -inset-4 bg-rose-600/30 blur-2xl rounded-full opacity-0 group-hover:opacity-100 transition duration-1000"></div>
                <img src="New folder (3)/surprise.jpg" onerror="this.src='https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?q=80&w=600&auto=format&fit=crop'" id="final-img" class="relative w-64 md:w-80 rounded-lg border border-white/10 shadow-2xl transform scale-90 opacity-0">
            </div>
            <h1 id="typewriter" class="text-xl md:text-4xl text-white font-royal text-center leading-relaxed h-20 px-4"></h1>
            <p class="text-white/30 text-[10px] mt-12 tracking-widest uppercase font-royal">Forever Yours.</p>
        </div>

    </div>

    <!-- Controls -->
    <div onclick="toggleMusic()" class="fixed bottom-6 right-6 text-white/40 hover:text-white cursor-pointer z-50 transition p-3 bg-black/20 rounded-full border border-white/5 hover:border-rose-500/50 backdrop-blur-md">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path d="M11.536 14.01A8.473 8.473 0 0 1 8 10a8.473 8.473 0 0 1 3.536-4.01C12.446 5.483 13 4.81 13 4v6c0 .81-.554 1.483-1.464 1.99z"/>
            <path d="M7.34 1.635a2.69 2.69 0 0 1 3.296 1.033 9.4 9.4 0 0 0-3.322 3.252 2.69 2.69 0 0 1-2.029-4.223 2.69 2.69 0 0 1 2.055-.062z"/>
            <path d="M2.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm0 7a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm6.29 4.35a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm6.29-4.35a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
    </div>

    <script>
        // --- 1. SETUP ---
        gsap.registerPlugin(TextPlugin, Draggable);
        
        // --- 2. THREE.JS BACKGROUND ---
        function initThree() {
            const canvas = document.getElementById('bg-canvas');
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050203, 0.002); 
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 1000;
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            const geometry = new THREE.BufferGeometry();
            const count = 1500;
            const positions = [];
            const colors = [];
            const colorObj = new THREE.Color();

            for(let i=0; i<count; i++) {
                positions.push((Math.random()-0.5)*2000, (Math.random()-0.5)*2000, (Math.random()-0.5)*2000);
                if(Math.random()>0.5) colorObj.setHex(0xe11d48); else colorObj.setHex(0xffffff);
                colors.push(colorObj.r, colorObj.g, colorObj.b);
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            const material = new THREE.PointsMaterial({ size: 2, vertexColors: true, transparent: true, opacity: 0.8 });
            const starField = new THREE.Points(geometry, material);
            scene.add(starField);

            function animate() {
                requestAnimationFrame(animate);
                starField.rotation.x += 0.0003; starField.rotation.y += 0.0003;
                renderer.render(scene, camera);
            }
            animate();
            window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        }

        // --- 3. AUDIO ---
        const audio = document.getElementById('bg-music');
        let musicPlaying = false;
        function toggleMusic() {
            if(musicPlaying) { gsap.to(audio, { volume: 0, duration: 1, onComplete: () => audio.pause() }); } 
            else { audio.volume = 0; audio.play(); gsap.to(audio, { volume: 0.5, duration: 2 }); }
            musicPlaying = !musicPlaying;
        }

        // --- 4. NAVIGATION ---
        let currentChap = 1;
        const totalChaps = 12;

        window.onload = () => {
            initThree();
            gsap.to("#loader", { opacity: 0, duration: 1.5, delay: 1, onComplete: () => {
                document.getElementById("loader").style.display = "none";
                document.getElementById("intro-screen").classList.remove("hidden");
            }});
        };

        function startJourney() {
            gsap.to("#intro-screen", { opacity: 0, duration: 2, pointerEvents: "none", onComplete: () => {
                document.getElementById("intro-screen").style.display = "none";
                document.getElementById("main-stage").classList.remove("hidden");
                gsap.to("#main-stage", { opacity: 1, duration: 2 });
                if(!musicPlaying) toggleMusic();
                playChapterAnim(1);
            }});
        }

        function nextChapter() {
            const curr = document.getElementById(`chap-${currentChap}`);
            const next = document.getElementById(`chap-${currentChap+1}`);
            
            // ANIMATE OUT CURRENT
            gsap.to("#progress", { width: `${(currentChap/totalChaps)*100}%`, duration: 1.5 });
            gsap.to(curr, { opacity: 0, scale: 0.95, filter: "blur(10px)", duration: 1, onComplete: () => {
                curr.classList.remove("chapter-active");
                // Force hide to prevent clicking through
                curr.style.display = "none";
                
                if(next) {
                    next.style.display = "flex"; // Make sure flex is restored
                    next.classList.add("chapter-active");
                    gsap.fromTo(next, { opacity: 0, scale: 1.05, filter: "blur(10px)" }, { opacity: 1, scale: 1, filter: "blur(0px)", duration: 1.5 });
                    currentChap++;
                    playChapterAnim(currentChap);
                }
            }});
        }

        function playChapterAnim(id) {
            gsap.fromTo(`#chap-${id} h2, #chap-${id} p`, { y: 30, opacity: 0 }, { y: 0, opacity: 1, duration: 1.5, stagger: 0.2, delay: 0.5 });
            gsap.fromTo(`#chap-${id} .majestic-btn`, { width: 0, opacity: 0 }, { width: "auto", opacity: 1, duration: 1, delay: 2 });
            
            // Logic Hooks
            if(id === 5) initHandDrag();
            if(id === 6) loadGallery();
            if(id === 7) initNumbers();
            if(id === 8) {
                gsap.to("#hug-text", { opacity: 1, duration: 3, delay: 1 });
                initCarousel();
            }
            if(id === 9) initPuzzleGame();
            if(id === 12) triggerFinale();
        }

        // --- EMOTIONAL INTERACTIONS ---
        
        // 1. SMILE SENSOR LOGIC (FIXED)
let smileActivated = false; // Prevents glitches

function activateSmile() {
    if (!smileActivated) {
        smileActivated = true;
        const msg = document.getElementById("smile-msg");
        const btn = document.getElementById("smile-btn");

        // Animate Message
        gsap.to(msg, { opacity: 1, y: -10, duration: 1 });
        
        // Animate Sensor
        gsap.to(".smile-sensor", { scale: 1.2, borderColor: "#fff", duration: 0.5 });
        confetti({ particleCount: 50, spread: 70, origin: { y: 0.6 } });

        // Show Button and Enable Clicking
        gsap.to(btn, { 
            opacity: 1, 
            duration: 1, 
            delay: 1, 
            onStart: () => {
                // Ensures button is clickable as soon as it starts appearing
                btn.style.pointerEvents = "auto";
                btn.style.cursor = "pointer";
            }
        });
    }
}        // 4. HEALING HEART
        function healHeart(el) {
            if(!el.classList.contains("healed")) {
                el.classList.add("healed");
                gsap.to("#heal-msg", { opacity: 1, y: -10, duration: 1.5 });
                gsap.to("#heal-btn", { opacity: 1, duration: 1, delay: 1.5 });
                document.getElementById("heal-btn").style.pointerEvents = "auto";
                confetti({ particleCount: 30, spread: 40, colors: ['#e11d48'], origin: { y: 0.5 } });
            }
        }

        // 5. HAND DRAG
        function initHandDrag() {
            Draggable.create("#her-hand", {
                type: "x,y",
                bounds: "#drag-zone",
                onDragEnd: function() {
                    const myHand = document.getElementById("my-hand").getBoundingClientRect();
                    const herHand = this.target.getBoundingClientRect();
                    // Simple distance check
                    const dx = Math.abs(myHand.left - herHand.left);
                    const dy = Math.abs(myHand.top - herHand.top);
                    
                    if(dx < 100 && dy < 100) {
                        gsap.to(this.target, { x: myHand.left - herHand.left, y: myHand.top - herHand.top, duration: 0.5 }); // Snap
                        gsap.to("#hand-msg", { opacity: 1, duration: 1 });
                        gsap.to("#hand-btn", { opacity: 1, duration: 1, delay: 1 });
                        document.getElementById("hand-btn").style.pointerEvents = "auto";
                        confetti({ particleCount: 50, spread: 60, colors: ['#fff', '#e11d48'] });
                        this.disable();
                    }
                }
            });
        }

        // 6. GALLERY (Your original logic)
        const memories = [
            { src: "New folder (3)/mylove1.jpg", text: "Your smile makes my winter warm." },
            { src: "New folder (3)/mylove2.jpg", text: "Eyes that hold my entire universe." },
            { src: "New folder (3)/mylove3.jpg", text: "I want to live in this moment forever." },
            { src: "New folder (3)/mylove4.jpg", text: "Elegance isn't what you wear, it's you." },
            { src: "New folder (3)/sur1.jpg", text: "Even in chaos, you are my calm." },
            { src: "New folder (3)/sur2.jpg", text: "Your laugh heals my broken parts." },
            { src: "New folder (3)/sur3.jpg", text: "My favorite view in the world." },
            { src: "New folder (3)/sur4.jpg", text: "Us. My favorite story." }
        ];
        let mIdx = 0;
        function loadGallery() { revealNextMemory(); }
        function revealNextMemory() {
            if(mIdx >= memories.length) { nextChapter(); return; }
            const stage = document.getElementById("gallery-stage");
            const data = memories[mIdx];
            Array.from(stage.children).forEach(el => gsap.to(el, { x: (Math.random()-0.5)*200, opacity: 0, duration: 1 }));
            const card = document.createElement("div");
            card.className = "polaroid absolute bg-white p-2 shadow-2xl transition-transform";
            card.innerHTML = `<div class="w-56 h-72 md:w-64 md:h-80 overflow-hidden"><img src="${data.src}" onerror="this.src='https://source.unsplash.com/random/400x500/?romance&sig=${mIdx}'" class="w-full h-full object-cover"></div>`;
            stage.appendChild(card);
            gsap.fromTo(card, { scale: 1.5, opacity: 0, rotation: 10 }, { scale: 1, opacity: 1, rotation: (Math.random()-0.5)*6, duration: 1.2, ease: "back.out" });
            gsap.fromTo("#gallery-caption", {opacity:0, y:10}, {opacity:1, y:0, text: data.text, duration: 1});
            mIdx++;
            if(mIdx === memories.length) document.getElementById("gallery-btn").innerText = "Continue";
        }

        // 7. NUMBERS & CONFESSIONS
        function initNumbers() {
            // Days since May 24, 2008 (Approx calculation)
            const start = new Date("2008-05-24");
            const now = new Date();
            const diff = Math.floor((now - start) / (1000 * 60 * 60 * 24));
            const obj = { val: 0 };
            const daysEl = document.getElementById("days-count");
            
            gsap.to(obj, { val: diff, duration: 3, ease: "power2.out", onUpdate: () => {
                daysEl.innerText = Math.floor(obj.val);
            }});
        }

        function revealConfession(el) {
            if(!el.classList.contains("revealed")) {
                el.classList.add("revealed");
                gsap.to(el, { scale: 1.05, duration: 0.3, yoyo: true, repeat: 1 });
            }
        }

        // 8. CAROUSEL (One Word)
        function initCarousel() {
            const words = ["Peace", "Home", "Comfort", "Happiness", "Forever", "Magic"];
            let wIdx = 0;
            setInterval(() => {
                wIdx = (wIdx + 1) % words.length;
                gsap.to("#word-carousel", { opacity: 0, duration: 0.5, onComplete: () => {
                    document.getElementById("word-carousel").innerText = words[wIdx];
                    gsap.to("#word-carousel", { opacity: 1, duration: 0.5 });
                }});
            }, 2500);
        }

        // 9. PUZZLE
        function initPuzzleGame() {
            const wrapper = document.getElementById('puzzle-wrapper');
            const container = document.getElementById('puzzle-container');
            container.innerHTML = '';
            document.getElementById('game-next-btn').style.opacity = 0;

            const rect = wrapper.getBoundingClientRect();
            const cols = 3, rows = 3;
            const pieceW = rect.width / cols;
            const pieceH = rect.height / rows;
            let solvedCount = 0;

            const msgs = ["A stranger...", "Became a friend...", "Then my best friend...", "Then my love...", "Now my soulmate...", "My everything...", "My home...", "My future...", "My Nayanika."];

            for(let r=0; r<rows; r++) {
                for(let c=0; c<cols; c++) {
                    const piece = document.createElement('div');
                    piece.className = 'puzzle-piece';
                    piece.style.width = pieceW + 'px';
                    piece.style.height = pieceH + 'px';
                    piece.style.backgroundPosition = `-${c*pieceW}px -${r*pieceH}px`;
                    piece.style.backgroundSize = `${rect.width}px ${rect.height}px`;
                    piece.style.top = (r*pieceH) + 'px';
                    piece.style.left = (c*pieceW) + 'px';

                    const safeX = (Math.random() * (window.innerWidth - pieceW)) - (window.innerWidth - rect.width)/2;
                    const safeY = (Math.random() * 200) - 100;
                    
                    gsap.set(piece, { x: safeX, y: safeY, opacity: 0, scale: 0.5 });
                    gsap.to(piece, { opacity: 1, scale: 1, duration: 0.5, delay: Math.random() * 0.5 });

                    piece.onclick = () => {
                        if(piece.classList.contains('piece-solved')) return;
                        piece.classList.add('piece-solved');
                        confetti({ particleCount: 10, spread: 20, origin: { x: piece.getBoundingClientRect().left/window.innerWidth, y: piece.getBoundingClientRect().top/window.innerHeight }, colors: ['#fff'] });
                        gsap.to(piece, { x: 0, y: 0, opacity: 1, duration: 0.5, border: "none", boxShadow: "none", zIndex: 1 });
                        
                        const txt = document.getElementById('puzzle-msg');
                        txt.innerText = msgs[solvedCount];
                        gsap.fromTo(txt, {opacity:0, y:5}, {opacity:1, y:0, duration: 0.5});
                        solvedCount++;
                        
                        if(solvedCount === cols*rows) {
                            gsap.to("#puzzle-container", { boxShadow: "0 0 50px #e11d48", duration: 1 });
                            document.getElementById('game-next-btn').style.pointerEvents = "auto";
                            gsap.to("#game-next-btn", { opacity: 1, y: -10, duration: 1 });
                            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                        }
                    };
                    container.appendChild(piece);
                }
            }
        }

        // 10. LETTER & PROMISES
        function openLetter() {
            gsap.to("#letter-closed", { rotationX: 180, opacity: 0, duration: 0.8, onComplete: () => {
                document.getElementById("letter-closed").style.display = "none";
                const content = document.getElementById("letter-content");
                content.classList.remove("hidden"); content.classList.add("flex");
                gsap.fromTo(content, { y: 50, opacity: 0 }, { y: 0, opacity: 1, duration: 1 });
            }});
        }

        const promises = [
            { title: "To Stay", desc: "I promise to stay even when it‚Äôs difficult.", img: "New folder (3)/promise1.jpg" },
            { title: "To Love", desc: "I promise to love you the way you deserve.", img: "New folder (3)/promise2.jpg" },
            { title: "To Listen", desc: "I promise to listen to the words you don‚Äôt say.", img: "New folder (3)/promise3.jpg" },
            { title: "To Protect", desc: "I promise to protect your heart like it‚Äôs my own.", img: "New folder (3)/promise4.jpg" },
            { title: "Companionship", desc: "I promise to never let you feel alone.", img: "New folder (3)/promise5.jpg" },
            { title: "My Choice", desc: "I promise to choose you again in every lifetime.", img: "New folder (3)/promise6.jpg" },
            { title: "Courage", desc: "I promise to hold your hand through every fear.", img: "New folder (3)/promise7.jpg" },
            { title: "Your Peace", desc: "I promise to be your peace.", img: "New folder (3)/promise8.jpg" },
            { title: "To Treasure", desc: "I promise to treasure your smile.", img: "New folder (3)/promise9.jpg" },
            { title: "To Grow", desc: "I promise to grow with you, not away from you.", img: "New folder (3)/promise10.jpg" },
            { title: "Reconciliation", desc: "I promise to always come back after every fight.", img: "New folder (3)/promise11.jpg" },
            { title: "Support", desc: "I promise to support your dreams.", img: "New folder (3)/promise12.jpg" },
            { title: "Acceptance", desc: "I promise to love the sides you hide.", img: "New folder (3)/promise13.jpg" },
            { title: "Priority", desc: "I promise to make you feel important.", img: "New folder (3)/promise14.jpg" },
            { title: "Loyalty", desc: "I promise to stay loyal.", img: "New folder (3)/promise15.jpg" },
            { title: "Gentleness", desc: "I promise to be gentle with your feelings.", img: "New folder (3)/promise16.jpg" },
            { title: "Trust", desc: "I promise to give you reasons to trust me.", img: "New folder (3)/promise17.jpg" },
            { title: "Endless Love", desc: "I promise to make you feel loved, always.", img: "New folder (3)/promise18.jpg" }
        ];

        let pIdx = 0;
        function loadPromise(i) {
            const p = promises[i];
            const img = document.getElementById("promise-img");
            const textCont = document.getElementById("promise-text-container");
            gsap.to(textCont, { opacity: 0, y: 10, duration: 0.5, onComplete: () => {
                document.getElementById("promise-title").innerText = p.title;
                document.getElementById("promise-desc").innerText = p.desc;
                document.getElementById("promise-count").innerText = `${i+1} / ${promises.length}`;
                gsap.to(img, { opacity: 0, duration: 0.5, onComplete: () => {
                    img.src = p.img;
                    img.onerror = function() { this.src = `https://source.unsplash.com/random/400x500/?love,couple&sig=${i}`; };
                    gsap.to(img, { opacity: 0.6, duration: 1 });
                }});
                gsap.to(textCont, { opacity: 1, y: 0, duration: 1, delay: 0.5 });
            }});
        }
        function nextPromise() {
            if(pIdx < promises.length-1) {
                pIdx++; loadPromise(pIdx);
                if(pIdx === promises.length-1) {
                    const btn = document.getElementById("promise-next-btn");
                    btn.innerText = "A Gift For You";
                    btn.onclick = nextChapter;
                }
            }
        }

        // 11. CAKE
        let candlesOut = 0;
        function blowCandle(el) {
            const flame = el.querySelector('.flame');
            if(flame && !flame.classList.contains('out')) {
                flame.classList.add('out'); candlesOut++;
                const smoke = document.createElement("div"); 
                smoke.style.cssText = `position:absolute; top:-30px; left:0; color:gray; font-size:20px; animation: floatUp 2s forwards;`;
                smoke.innerText = "üí®"; el.appendChild(smoke);
                if(candlesOut === 3) document.getElementById("wish-instruction").innerText = "Wish made. Now cut the cake.";
            }
        }
        function checkCake() {
            if(candlesOut === 3) { confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } }); nextChapter(); } 
            else { alert("Blow the candles first, my love!"); }
        }

        // 12. FINALE
        function triggerFinale() {
            gsap.fromTo("#final-img", { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 2, ease: "power2.out" });
            const msg = "Happy 17th Birthday, Nayanika. You are the poem I never knew how to write.";
            gsap.to("#typewriter", { text: msg, duration: 6, delay: 1, ease: "none" });
            const end = Date.now() + 5000;
            const colors = ['#be123c', '#fb7185', '#fff1f2'];
            (function frame() {
                confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
                confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        // GLOBAL PETALS
        const petalTexts = ["Mine", "My Heart", "My Peace", "My Girl", "Always", "Forever"];
        function createPetal(e) {
            if(e.target.tagName === 'BUTTON' || e.target.classList.contains('puzzle-piece') || e.target.closest('.confession-card')) return;
            const txt = document.createElement("div");
            txt.className = "petal-text";
            txt.innerText = petalTexts[Math.floor(Math.random() * petalTexts.length)];
            txt.style.left = e.clientX + "px";
            txt.style.top = e.clientY + "px";
            document.body.appendChild(txt);
            setTimeout(() => txt.remove(), 3000);
            confetti({ particleCount: 5, spread: 30, startVelocity: 10, origin: { x: e.clientX/window.innerWidth, y: e.clientY/window.innerHeight }, colors: ['#fda4af', '#fff'] });
        }
        
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `@keyframes floatUp { 0% { opacity: 0.8; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-50px); } }`;
        document.head.appendChild(styleSheet);

    </script>
</body>
</html>
